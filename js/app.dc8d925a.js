(function(e){function t(t){for(var a,s,o=t[0],u=t[1],c=t[2],m=0,d=[];m<o.length;m++)s=o[m],Object.prototype.hasOwnProperty.call(i,s)&&i[s]&&d.push(i[s][0]),i[s]=0;for(a in u)Object.prototype.hasOwnProperty.call(u,a)&&(e[a]=u[a]);l&&l(t);while(d.length)d.shift()();return n.push.apply(n,c||[]),r()}function r(){for(var e,t=0;t<n.length;t++){for(var r=n[t],a=!0,o=1;o<r.length;o++){var u=r[o];0!==i[u]&&(a=!1)}a&&(n.splice(t--,1),e=s(s.s=r[0]))}return e}var a={},i={app:0},n=[];function s(t){if(a[t])return a[t].exports;var r=a[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=a,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)s.d(r,a,function(t){return e[t]}.bind(null,a));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/imgalign/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],u=o.push.bind(o);o.push=t,o=o.slice();for(var c=0;c<o.length;c++)t(o[c]);var l=u;n.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},"2bd5":function(e,t,r){"use strict";r("74f9")},"328b":function(e,t,r){"use strict";r("ba28")},"38cc":function(e,t,r){},"56d7":function(e,t,r){"use strict";r.r(t);r("cadf"),r("551c"),r("f751"),r("097d");var a=r("2b0e"),i=(r("d1e7"),r("bb71"));r("da64");a["a"].use(i["a"],{iconfont:"md"});var n=r("7496"),s=r("549c"),o=function(){var e=this,t=e._self._c;return t(n["a"],[t(s["a"],[t("router-view")],1)],1)},u=[],c={name:"App"},l=c,m=(r("d35d"),r("2877")),d=Object(m["a"])(l,o,u,!1,null,null,null),g=d.exports,p=r("8c4f"),h=function(){var e=this,t=e._self._c;return t("div",{staticClass:"stitcher"},[t("h1",[e._v("Store Aisle Scanner")]),t("app-camera-capture",{ref:"camera",on:{capture:e.handleCameraCapture,error:e.handleCameraError}}),e._m(0),t("div",{staticClass:"main-actions"},[t("button",{staticClass:"primary-btn",attrs:{disabled:e.$store.getters["worker/busyCompute"]},on:{click:e.startCamera}},[t("span",{staticClass:"btn-icon"},[e._v("ðŸ“¸")]),e._v("\n      Take Photo\n    ")]),t("button",{staticClass:"secondary-btn",attrs:{disabled:e.$store.getters["worker/busyCompute"]},on:{click:e.openFileSelector}},[t("span",{staticClass:"btn-icon"},[e._v("ðŸ“")]),e._v("\n      Upload from Gallery\n    ")]),t("input",{ref:"fileInput",staticStyle:{display:"none"},attrs:{type:"file",accept:"image/*",multiple:""},on:{change:e.handleFileSelect}})]),e.$store.getters["multiInput/imageCount"]>0?t("div",{staticClass:"photo-status"},[t("span",{staticClass:"photo-count"},[e._v(e._s(e.$store.getters["multiInput/imageCount"])+" photos taken")]),t("div",{staticClass:"photo-actions"},[e.$store.getters["multiInput/indicesSelected"].length>0?t("button",{staticClass:"action-btn delete-btn",on:{click:e.deleteSelectedInputImages}},[t("span",{staticClass:"btn-icon"},[e._v("âœ•")]),e._v("\n        Delete Selected\n      ")]):e._e(),t("button",{staticClass:"action-btn delete-btn",attrs:{disabled:0===e.$store.getters["multiInput/imageCount"]},on:{click:e.deleteAllOrSelectedInputImages}},[t("span",{staticClass:"btn-icon"},[e._v("ðŸ—‘ï¸")]),e._v("\n        Clear All\n      ")])])]):e._e(),t("div",{staticClass:"photos-area"},[0===e.$store.getters["multiInput/imageCount"]?t("div",{staticClass:"empty-state"},[t("p",[e._v("No photos taken yet")]),t("p",{staticClass:"tip"},[e._v("Stand in the center of the aisle for best results")])]):t("app-multi-input-images",{attrs:{imageUrlArray:e.$store.getters["multiInput/imageDataUrlsArray"],imageKeyArray:e.$store.getters["multiInput/imageDataKeyArray"],fieldOfViewArray:e.$store.getters["multiInput/imageFieldOfViewArray"],indicesSelected:e.$store.getters["multiInput/indicesSelected"]},on:{imageClicked:function(t){return e.$store.commit("multiInput/imageClicked",t)},swap:e.swapImagesInputImages}}),e.$store.getters["multiInput/imageCount"]>0?t("p",{staticClass:"tip"},[e._v("\n      âœ¨ Tip: Make sure each photo overlaps with the previous one\n    ")]):e._e()],1),e.$store.getters["multiInput/imageCount"]>1?t("div",{staticClass:"panorama-action"},[t("button",{staticClass:"primary-btn create-btn",attrs:{disabled:e.$store.getters["worker/busyCompute"]},on:{click:e.multiStitch}},[t("span",{staticClass:"btn-icon"},[e._v("ðŸ”„")]),e._v("\n      Create Panorama\n    ")])]):e._e(),e.resultValid?t("div",{staticClass:"result-container"},[t("h3",[e._v("Your Stitched Panorama:")]),t("app-image-result",{attrs:{"image-url":e.$store.getters["worker/results/imageDataUrl"](e.multiStitchName),"image-name":e.multiStitchName,canDrag:!1}}),t("div",{staticClass:"result-actions"},[t("button",{staticClass:"primary-btn save-btn",on:{click:e.saveImage}},[t("span",{staticClass:"btn-icon"},[e._v("ðŸ’¾")]),e._v("\n        Save Panorama\n      ")])])],1):e._e(),t("div",{staticClass:"history-section"},[t("h3",[e._v("Previous Panoramas")]),0===e.history.length?t("div",{staticClass:"empty-history"},[t("p",{staticClass:"tip"},[e._v("No previous panoramas yet")])]):t("div",{staticClass:"history-items"},e._l(e.history,(function(r){return t("div",{key:r.id,staticClass:"history-item"},[t("div",{staticClass:"history-timestamp"},[e._v(e._s(r.timestamp))]),t("div",{staticClass:"history-images"},[t("div",{staticClass:"source-images"},e._l(r.sourceImages,(function(e,r){return t("img",{key:r,staticClass:"source-image",attrs:{src:e,alt:"Source image"}})})),0),t("div",{staticClass:"result-image"},[t("img",{attrs:{src:r.imageUrl,alt:"Panorama result"}})])])])})),0)]),e.$store.getters["worker/error"]?t("div",{staticClass:"error-container"},[t("p",[e._v("âŒ "+e._s(e.friendlyErrorMessage))]),t("p",{staticClass:"error-tip"},[e._v("Try making sure your photos have enough overlap and are in the correct order.")])]):e._e()],1)},f=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"instructions"},[t("h3",[e._v("How to capture an aisle:")]),t("ol",[t("li",[e._v("Stand at one end of the aisle")]),t("li",[e._v('Click "Take Photo" and capture the first section')]),t("li",[e._v("Move a few steps down the aisle (make sure sections overlap)")]),t("li",[e._v("Repeat until you reach the end")]),t("li",[e._v('Click "Create Panorama" to combine all photos')])])])}],y=(r("7f7f"),r("5df3"),r("1c4c"),r("ac6a"),r("75fc")),v=(r("96cf"),r("3b8d")),b=(r("6762"),r("2fdb"),function(){var e=this,t=e._self._c;return t("transition",{attrs:{name:"images-all"}},[e.imageUrlArray.length>0?t("div",{style:{width:"100%",border:"1px solid #00000055","background-color":"#f6f6f6",padding:"0.1rem 0.1rem","margin-top":"1rem"}},[t("transition-group",{style:{display:"grid","grid-template-columns":"repeat(auto-fill, ".concat(e.gridCellWidth,"%)"),"grid-template-rows":"auto",margin:"0 auto",width:"100%"},attrs:{tag:"div",name:"images-list-items"}},e._l(e.imageUrlArray,(function(r,a){return t("div",{key:e.imageKeyArray[a],style:{outline:e.$store.getters["multiInput/imageDataValid"](a)?"".concat(e.borderLineWidth(a)," solid ").concat(e.borderColor(a)):null,margin:"3px",display:"flex","align-items":"center","justify-content":"center"},on:{click:function(t){return t.stopPropagation(),e.imageClicked(a)},drop:function(t){return t.preventDefault(),function(t){return e.dragDrop(t,a)}.apply(null,arguments)},dragover:function(e){return e.preventDefault(),function(){}.apply(null,arguments)},dragend:function(e){return e.preventDefault(),function(){}.apply(null,arguments)},dragenter:function(e){return e.preventDefault(),function(){}.apply(null,arguments)}}},[t("div",{style:{padding:"0.3rem","background-color":"#ffffff"}},[t("div",{style:{position:"relative"}},[t("img",{ref:a+"",refInFor:!0,staticClass:"transparent-pattern",style:{display:"block","max-width":"100%","max-height":"100%",width:"auto",height:"auto"},attrs:{id:a+"",src:r},on:{dragstart:function(t){return e.dragStart(t,a)},dragover:function(e){return e.preventDefault(),function(){}.apply(null,arguments)},dragend:function(e){return e.preventDefault(),function(){}.apply(null,arguments)}}}),t("div",{style:{position:"absolute",bottom:"0px",right:"0px",color:e.$vuetify.theme.primary,transform:"translateY(0%) translateX(0%)","background-color":e.$vuetify.theme.accent,padding:"0.1rem 0.3rem",margin:"0 0.2rem 0.2rem 0"}},[t("strong",[e._v(e._s(a))])])])])])})),0)],1):e._e()])}),w=[],I=(r("c5f6"),{props:{imageUrlArray:{type:Array,required:!0},imageKeyArray:{type:Array,required:!0},fieldOfViewArray:{type:Array,required:!0},indicesSelected:{type:Array,required:!0}},computed:{gridCellWidth:function(){return"xs"==this.$vuetify.breakpoint.name?50:"sm"==this.$vuetify.breakpoint.name?33.3333333:25}},methods:{imageClicked:function(e){this.$emit("imageClicked",e)},borderColor:function(e){return this.indicesSelected.some((function(t){return t==e}))?this.$vuetify.theme.error:this.$vuetify.theme.secondary},borderLineWidth:function(e){return this.indicesSelected.some((function(t){return t==e}))?"2px":"1px"},dragStart:function(e,t){e.dataTransfer.setData("number/indexFrom",t)},dragDrop:function(e,t){var r=e.dataTransfer.getData("number/indexFrom");r&&(r=Number(r)),isNaN(r)||this.$emit("swap",{indexFrom:r,indexTo:t})}}}),_=I,x=(r("328b"),Object(m["a"])(_,b,w,!1,null,"0ad41ba8",null)),k=x.exports,S=r("169a"),D=function(){var e=this,t=e._self._c;return t("div",{ref:"mainDiv"},[t("div",{style:{border:"1px solid ".concat(e.$vuetify.theme.secondary),padding:"0.3rem"}},[t("img",{ref:e.imageName,staticClass:"transparent-pattern",class:e.imgClasses,style:{display:"block","max-width":"100%","max-height":"50vh",width:"auto",height:"auto",margin:"auto",padding:"0"},attrs:{id:e.imageName,src:e.imageUrl,draggable:"true"},on:{click:function(t){return t.stopPropagation(),e.showUnscaledIf.apply(null,arguments)},load:function(t){e.canShowDialog=e.isImageScaled()},dragstart:e.dragStart,dragover:function(e){return e.preventDefault(),function(){}.apply(null,arguments)},dragend:function(e){return e.preventDefault(),function(){}.apply(null,arguments)}}})]),t(S["a"],{ref:e.dialog.name,attrs:{attach:e.$refs.mainDiv,persistent:"",stlye:{cursor:"move"},"content-class":"transparent-pattern"},on:{keydown:function(t){if(!t.type.indexOf("key")&&e._k(t.keyCode,"esc",27,t.key,["Esc","Escape"]))return null;e.showDialog=!1}},model:{value:e.showDialog,callback:function(t){e.showDialog=t},expression:"showDialog"}},[t("img",{ref:e.dialog.imageName,staticClass:"transparent-pattern",attrs:{id:e.dialog.imageName,src:e.imageUrl,stlye:{cursor:"move",display:"block"}},on:{mousedown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"left",37,t.key,["Left","ArrowLeft"])||"button"in t&&0!==t.button?null:(t.stopPropagation(),e.startDrag.apply(null,arguments))},touchstart:function(t){return t.stopPropagation(),e.startDrag.apply(null,arguments)}}})])],1)},A=[],O={props:{imageName:{type:String,required:!0},imageUrl:{validator:function(){return!0},required:!0},projected:{type:Boolean,default:!1},fieldOfView:{type:Number,default:0},canDrag:{type:Boolean,default:!0}},computed:{imgClasses:function(){return{"cursor-drag-zoom":this.canShowDialog&&this.canDrag,"cursor-drag":!this.canShowDialog&&this.canDrag,"cursor-zoom-in":this.canShowDialog&&!this.canDrag}}},data:function(){return{showDialog:!1,canShowDialog:!1,htmlStyleOverflowY:null,clickPos:{x:null,y:null},dialog:{name:"dialog_000a",imageName:this.imageName+"D",startPos:{x:null,y:null},dims:{w:null,h:null},scrollInfo:{w:null,h:null,lMax:null,lStart:null,tMax:null,tStart:null},innerDialog:function(e){return e[this.name].$refs.dialog},hideScrollbars:function(e){"hidden"!=this.innerDialog(e).style.overflow&&(this.innerDialog(e).style.overflow="hidden")},setMoveCursor:function(e){this.innerDialog(e).style.cursor="move"},dragMode:function(){return null!=this.startPos.x},stop:function(){this.startPos.x=null},start:function(e,t,r){console.assert(this.innerDialog(r),"Inner dialog must not be null"),this.startPos.x=e,this.startPos.y=t,this.dims.w=this.innerDialog(r).clientWidth,this.dims.h=this.innerDialog(r).clientHeight,this.scrollInfo.w=r[this.imageName].scrollWidth,this.scrollInfo.h=r[this.imageName].scrollHeight,this.scrollInfo.lMax=this.scrollInfo.w-this.dims.w,this.scrollInfo.tMax=this.scrollInfo.h-this.dims.h,this.scrollInfo.lStart=this.innerDialog(r).scrollLeft,this.scrollInfo.tStart=this.innerDialog(r).scrollTop,this.moved=!1},move:function(e,t,r){if(this.dragMode()){(Math.abs(this.startPos.x-e)>2||Math.abs(this.startPos.y-t)>2)&&(this.moved=!0);var a=this.scrollInfo.lStart+this.startPos.x-e;a<this.scrollInfo.lMax&&(this.innerDialog(r).scrollLeft=a);var i=this.scrollInfo.tStart+this.startPos.y-t;i<this.scrollInfo.tMax&&(this.innerDialog(r).scrollTop=i)}},init:function(e,t,r){var a=this.innerDialog(r).clientWidth,i=this.innerDialog(r).clientHeight,n=r[this.imageName].scrollWidth,s=r[this.imageName].scrollHeight,o=n-a,u=s-i,c=e-a/2,l=t-i/2;this.innerDialog(r).scrollLeft=c<o?c:o,this.innerDialog(r).scrollTop=l<u?l:u}}}},methods:{showUnscaledIf:function(e){if(this.canShowDialog){this.showDialog=!0;var t=this.scaleFactor();t>1&&(this.clickPos.x=t*(e.layerX-e.target.offsetLeft),this.clickPos.y=t*(e.layerY-e.target.offsetTop))}},isImageScaled:function(){return this.$refs&&this.$refs[this.imageName]&&(this.$refs[this.imageName].naturalWidth>this.$refs[this.imageName].width||this.$refs[this.imageName].naturalHeight>this.$refs[this.imageName].height)},scaleFactor:function(){return this.isImageScaled()?this.$refs[this.imageName].naturalWidth/this.$refs[this.imageName].width:1},startDrag:function(e){var t;e.preventDefault(),(t=this.dialog).start.apply(t,Object(y["a"])(this.coords(e)).concat([this.$refs])),this.addListeners()},endDrag:function(){this.removeAllDialogListeners(),this.dialog.dragMode()&&!this.dialog.moved&&(this.showDialog=!1),this.dialog.stop()},addListeners:function(){var e=this;window&&(this.mousemoveListener||(this.mousemoveListener=window.addEventListener("mousemove",(function(t){var r;return(r=e.dialog).move.apply(r,Object(y["a"])(e.coords(t)).concat([e.$refs]))}))),this.touchmoveListener||(this.touchmoveListener=window.addEventListener("touchmove",(function(t){var r;return(r=e.dialog).move.apply(r,Object(y["a"])(e.coords(t)).concat([e.$refs]))}))),this.mouseupListener||(this.mouseupListener=window.addEventListener("mouseup",this.endDrag)),this.touchendListener||(this.touchendListener=window.addEventListener("touchend",this.endDrag)))},removeAllDialogListeners:function(){window&&(this.mousemoveListener&&(window.removeEventListener(this.mousemoveListener),this.mousemoveListener=null),this.mouseupListener&&(window.removeEventListener(this.mouseupListener),this.mouseupListener=null),this.touchmoveListener&&(window.removeEventListener(this.touchmoveListener),this.mousemoveListener=null),this.touchendListener&&(window.removeEventListener(this.touchendListener),this.touchendListener=null))},coords:function(e){return e.touches&&e.touches.length>0?[e.touches[0].clientX,e.touches[0].clientY]:[e.clientX,e.clientY]},dragStart:function(e){e.dataTransfer.setData("text/plain",this.imageUrl),e.dataTransfer.setData("number/projected",this.projected?1:0),e.dataTransfer.setData("number/fieldOfView",this.fieldOfView)}},mounted:function(){var e=this;window&&!this.resizeListener&&(this.resizeListener=window.addEventListener("resize",(function(){e.canShowDialog=e.isImageScaled(),!e.canShowDialog&&e.showDialog&&(e.showDialog=!1)})))},beforeUpdate:function(){this.showDialog?(this.htmlStyleOverflowY=document.documentElement.style.overflowY,document.documentElement.style.overflowY="auto"):(document.documentElement.style.overflowY=this.htmlStyleOverflowY,document.documentElement.classList.contains("overflow-y-hidden")&&document.documentElement.classList.remove("overflow-y-hidden"))},updated:function(){this.showDialog&&(this.dialog.hideScrollbars(this.$refs),this.dialog.setMoveCursor(this.$refs),null!=this.clickPos.x&&null!=this.clickPos.y&&(this.dialog.init(this.clickPos.x,this.clickPos.y,this.$refs),this.clickPos.x=null,this.clickPos.y=null))},beforeDestroy:function(){this.removeAllDialogListeners(),window&&this.resizeListener&&(window.removeEventListener(this.resizeListener),this.resizeListener=null)}},T=O,R=(r("acb3"),Object(m["a"])(T,D,A,!1,null,"5eed89ac",null)),j=R.exports,C=function(){var e=this,t=e._self._c;return t("div",{staticClass:"camera-capture"},[e.showCamera?e._e():t("div",{staticClass:"camera-start"},[e._t("trigger-button")],2),e.showCamera?t("div",{staticClass:"camera-container"},[t("div",{staticClass:"camera-preview"},[t("video",{ref:"video",staticClass:"camera-video",attrs:{autoplay:"",playsinline:"",muted:""},domProps:{muted:!0}}),e._m(0),t("div",{staticClass:"camera-actions"},[t("button",{staticClass:"camera-action-btn capture",on:{click:e.capture}},[e._v("\n          ðŸ“¸ Capture\n        ")]),t("button",{staticClass:"camera-action-btn cancel",on:{click:e.close}},[e._v("\n          âœ• Cancel\n        ")])])]),t("canvas",{ref:"canvas",staticStyle:{display:"none"}})]):e._e(),e.hasGetUserMedia?e._e():t("input",{ref:"fileInput",staticStyle:{display:"none"},attrs:{type:"file",accept:"image/*",capture:"environment"},on:{change:e.handleFileSelect}})])},F=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"camera-overlay"},[t("div",{staticClass:"camera-guide"},[t("div",{staticClass:"guide-top"}),t("div",{staticClass:"guide-text"},[e._v("Overlap your aisle photo by 30% with the previous photo")]),t("div",{staticClass:"guide-bottom"})])])}],P=(r("7514"),{name:"CameraCapture",data:function(){return{showCamera:!1,stream:null,hasGetUserMedia:!1,isMobile:!1}},created:function(){this.hasGetUserMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia),this.isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},methods:{start:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(){var t,r,a=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.hasGetUserMedia){e.next=3;break}return this.$refs.fileInput.click(),e.abrupt("return");case 3:return e.prev=3,e.next=6,this.getOptimalConstraints();case 6:return t=e.sent,e.next=9,navigator.mediaDevices.getUserMedia(t);case 9:return this.stream=e.sent,this.showCamera=!0,e.next=13,this.$nextTick();case 13:if(r=this.$refs.video,r){e.next=16;break}throw new Error("Video element not found");case 16:return r.srcObject=this.stream,r.muted=!0,e.next=20,new Promise((function(e,t){r.onloadedmetadata=function(){r.play().then((function(){if(a.isMobile)try{var t=document.documentElement;t.requestFullscreen?t.requestFullscreen().then(e).catch(e):e()}catch(r){e()}else e()})).catch(t)},r.onerror=t}));case 20:e.next=26;break;case 22:e.prev=22,e.t0=e["catch"](3),this.$emit("error",{name:e.t0.name||"CameraError",message:"Camera initialization failed: ".concat(e.t0.message||"Unknown error")}),this.close();case 26:case"end":return e.stop()}}),e,this,[[3,22]])})));function t(){return e.apply(this,arguments)}return t}(),getOptimalConstraints:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(){var t,r,a,i,n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t={video:{width:{ideal:1080},height:{ideal:1920}},audio:!1},!this.isMobile){e.next=29;break}return t.video.facingMode={exact:"environment"},e.prev=3,e.next=6,navigator.mediaDevices.enumerateDevices();case 6:if(r=e.sent,a=r.filter((function(e){return"videoinput"===e.kind})),!(a.length>0)){e.next=23;break}if(i=a.find((function(e){return e.label.toLowerCase().includes("back")||e.label.toLowerCase().includes("environment")})),!i){e.next=23;break}return t.video.deviceId={exact:i.deviceId},e.prev=12,e.next=15,navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:i.deviceId}}}).then((function(e){return e.getVideoTracks()[0]}));case 15:n=e.sent,s=n.getCapabilities(),n.stop(),s&&s.width&&s.height&&(t.video.width={ideal:Math.min(s.width.max,1080)},t.video.height={ideal:Math.min(s.height.max,1920)}),e.next=23;break;case 21:e.prev=21,e.t0=e["catch"](12);case 23:e.next=27;break;case 25:e.prev=25,e.t1=e["catch"](3);case 27:e.next=30;break;case 29:t.video.facingMode="user";case 30:return e.abrupt("return",t);case 31:case"end":return e.stop()}}),e,this,[[3,25],[12,21]])})));function t(){return e.apply(this,arguments)}return t}(),close:function(){if(this.showCamera){try{document.fullscreenElement&&document.exitFullscreen()}catch(e){}this.stream&&(this.stream.getTracks().forEach((function(e){return e.stop()})),this.stream=null),this.showCamera=!1}},capture:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(){var t,r,a,i,n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.$refs.video,r=this.$refs.canvas,r.width=t.videoWidth,r.height=t.videoHeight,a=r.getContext("2d"),i=window.devicePixelRatio||1,i>1&&(r.style.width=r.width+"px",r.style.height=r.height+"px",r.width*=i,r.height*=i,a.scale(i,i)),a.drawImage(t,0,0),e.prev=8,e.next=11,new Promise((function(e){r.toBlob(e,"image/jpeg",.95)}));case 11:n=e.sent,s=new File([n],"photo_".concat(Date.now(),".jpg"),{type:"image/jpeg",lastModified:Date.now()}),this.$emit("capture",s),this.close(),e.next=20;break;case 17:e.prev=17,e.t0=e["catch"](8),this.$emit("error",e.t0);case 20:case"end":return e.stop()}}),e,this,[[8,17]])})));function t(){return e.apply(this,arguments)}return t}(),handleFileSelect:function(e){if(e.target.files&&e.target.files.length>0){var t=e.target.files[0];this.$emit("capture",t),e.target.value=""}}},beforeDestroy:function(){this.close()}}),V=P,M=(r("2bd5"),Object(m["a"])(V,C,F,!1,null,"3cdd8ffe",null)),N=M.exports,E="fixed",B="moving",L="result",U="compare",q="stitch",$="multiStitch",z=(r("456d"),r("d225")),G=r("b0b4"),W=(r("0d6d"),Object.freeze({other:{id:1001,name:"Other"},sift:{id:1002,name:"Sift"},surf:{id:1003,name:"Surf"},orb:{id:1004,name:"Orb"},brisk:{id:1005,name:"Brisk"},kaze:{id:1006,name:"Kaze"},akaze:{id:1007,name:"Akaze"},basic:{id:1008,name:"Basic"},compare:{id:1009,name:"Compare"},matchFilter:{id:1010,name:"Match Filter"},logging:{id:1011,name:"Logging"},stitching:{id:1012,name:"Stitching"},stitcherCommon:{id:1013,name:"Common"},stitcherOrientation:{id:1014,name:"Orientation"},stitcherProjection:{id:1015,name:"Projection"},multiStitcher:{id:1016,name:"Multi Stitcher"},multiStitcherCamera:{id:1017,name:"Camera"},multiStitcherSeams:{id:1018,name:"Seams"},multiStitcherImage:{id:1019,name:"Image"},multiStitcherStitchOrder:{id:1020,name:"Experimental"},multiStitcherMemory:{id:1021,name:"Memory"},multiStitcherConfidence:{id:1022,name:"Confidence"},main:{id:1023,name:"Main"},imageInput:{id:1024,name:"Image Input"}})),K=200,H=201,Y=202,J=203,X=301,Q=302,Z=303,ee=304,te=305,re=583,ae=591,ie=577,ne=610,se=810,oe=Object.freeze({imageCapInput:{id:11,name:"Input images image cap",groupId:W.imageInput.id},imageCap:{id:10,name:"Image cap for detector",groupId:W.imageInput.id},openCvType:{id:se,name:"OpenCV type",groupId:W.main.id},openCvType_fast:{id:811,name:"Fast",groupId:se},openCvType_small:{id:812,name:"Small",groupId:se},sift_featuresN:{id:20,name:"Max feature count",groupId:W.sift.id},sift_octaveLayersN:{id:21,name:"Number of octave layers",groupId:W.sift.id},sift_contrastThresh:{id:22,name:"Contrast threshold",groupId:W.sift.id},sift_edgeThresh:{id:23,name:"Edge threshold",groupId:W.sift.id},sift_sigma:{id:24,name:"Sigma",groupId:W.sift.id},surf_hessianThresh:{id:30,name:"Hessian threshold",groupId:W.surf.id},surf_octavesN:{id:31,name:"Number of octaves",groupId:W.surf.id},surf_octaveLayersN:{id:32,name:"Number of octave layers",groupId:W.surf.id},surf_extended:{id:33,name:"64/128 bit descriptor",groupId:W.surf.id},orb_featuresN:{id:40,name:"Max feature count",groupId:W.orb.id},orb_scale:{id:41,name:"Scale",groupId:W.orb.id},orb_levelsN:{id:42,name:"Number of levels",groupId:W.orb.id},orb_edgeThresh:{id:43,name:"Edge threshold",groupId:W.orb.id},orb_patchSize:{id:44,name:"Patch size",groupId:W.orb.id},brisk_thresh:{id:50,name:"Threshold",groupId:W.brisk.id},brisk_octavesN:{id:51,name:"Number of octaves",groupId:W.brisk.id},brisk_patternScale:{id:52,name:"Pattern scale",groupId:W.brisk.id},kaze_thresh:{id:53,name:"Threshold",groupId:W.kaze.id},kaze_octavesN:{id:54,name:"Number of octaves",groupId:W.kaze.id},kaze_octaveLayersN:{id:55,name:"Number of octave layers",groupId:W.kaze.id},akaze_thresh:{id:56,name:"Threshold",groupId:W.akaze.id},akaze_octavesN:{id:57,name:"Number of octaves",groupId:W.akaze.id},akaze_octaveLayersN:{id:58,name:"Number of octave layers",groupId:W.akaze.id},detType_sift:{id:60,name:"Sift",groupId:K},detType_surf:{id:61,name:"Surf",groupId:K},detType_orb:{id:62,name:"Orb",groupId:K},detType_brisk:{id:63,name:"Brisk",groupId:K},detType_kaze:{id:64,name:"Kaze",groupId:K},detType_akaze:{id:65,name:"Akaze",groupId:K},desType_sift:{id:80,name:"Sift",groupId:H},desType_surf:{id:81,name:"Surf",groupId:H},desType_orb:{id:82,name:"Orb",groupId:H},desType_brisk:{id:83,name:"Brisk",groupId:H},desType_freak:{id:84,name:"Freak",groupId:H},desType_kaze:{id:85,name:"Kaze",groupId:H},desType_akaze:{id:86,name:"Akaze",groupId:H},matcherType_flann:{id:100,name:"Flann",groupId:Y},matcherType_bfhamming:{id:101,name:"Brute force hamming",groupId:Y},matcherType_bfhamming2:{id:102,name:"Brute force hamming 2",groupId:Y},matcherType_auto:{id:103,name:"Auto",groupId:Y},transformFinderType_ransac:{id:120,name:"Ransac",groupId:J},transformFinderType_rho:{id:121,name:"Rho",groupId:J},transformFinderType_lmeds:{id:122,name:"Lmeds",groupId:J},detType:{id:K,name:"Detector",groupId:W.basic.id},desType:{id:H,name:"Descriptor",groupId:W.basic.id},matcherType:{id:Y,name:"Matcher",groupId:W.basic.id},transformFinderType:{id:J,name:"Transform finder",groupId:W.basic.id},compareDetTypes:{id:X,name:"Choose detectors",groupId:W.compare.id},compareImageType:{id:Q,name:"Choose image",groupId:W.compare.id},imageFirst:{id:130,name:"First image",groupId:Q},imageSecond:{id:131,name:"Second image",groupId:Q},matchFilterSpreadAuto:{id:140,name:"Spread factor automatic",groupId:W.matchFilter.id},matchFilterSpreadFactor:{id:141,name:"Spread factor",groupId:W.matchFilter.id,disabledIfId:140},matchFilterMinMatchesToRetain:{id:142,name:"Min match count",groupId:W.matchFilter.id},matchFilterMaxMatchesToRetain:{id:143,name:"Max match count",groupId:W.matchFilter.id},floodFillTolerance:{id:150,name:"Flood fill tolerance",groupId:W.other.id},alignSelectionOverlay:{id:151,name:"Overlay selection",groupId:W.other.id},logInfoEnabled:{id:152,name:"Verbose logging",groupId:W.logging.id},logErrorEnabled:{id:153,name:"Log errors",groupId:W.logging.id},logAssertEnabled:{id:154,name:"Log assertions",groupId:W.logging.id},logExternEnabled:{id:155,name:"Log extern messages",groupId:W.logging.id},stitch_projection:{id:Z,name:"Surface projection 1",groupId:W.stitcherProjection.id},stitch_projection2:{id:ee,name:"Surface projection 2",groupId:W.stitcherProjection.id},stitch_seamBlend:{id:501,name:"Seam blend",groupId:W.stitcherCommon.id},stitch_colorTransfer:{id:502,name:"Color transfer",groupId:W.stitcherCommon.id},stitch_fieldOfView1:{id:511,name:"Field of view 1",groupId:W.stitcherOrientation.id},stitch_yaw1:{id:513,name:"Yaw 1",groupId:W.stitcherOrientation.id},stitch_pitch1:{id:514,name:"Pitch 1",groupId:W.stitcherOrientation.id},stitch_fieldOfView2:{id:521,name:"Field of view 2",groupId:W.stitcherOrientation.id},stitch_yaw2:{id:523,name:"Yaw 2",groupId:W.stitcherOrientation.id},stitch_pitch2:{id:524,name:"Pitch 2",groupId:W.stitcherOrientation.id},stitch_yaw2Auto:{id:525,name:"Yaw 2 auto",groupId:null},stitch_pitch2Auto:{id:526,name:"Pitch 2 auto",groupId:null},stitch_projectionTypeNone:{id:561,name:"None",groupId:Z,groupId2:ee,groupId3:te},stitch_projectionTypeSpherical:{id:553,name:"Spherical",groupId:Z,groupId2:ee,groupId3:te},stitch_projectionTypeCylindrical:{id:552,name:"Cylindrical",groupId:Z,groupId2:ee,groupId3:te},stitch_projectionTypeMercator:{id:559,name:"Mercator ",groupId:Z,groupId2:ee,groupId3:te},stitch_projectionTypeTransverseMercator:{id:560,name:"Transverse Mercator",groupId:Z,groupId2:ee,groupId3:te},stitch_projectionTypeFisheye:{id:554,name:"Fisheye",groupId:Z,groupId2:ee,groupId3:te},stitch_projectionTypePlane:{id:550,name:"Plane",groupId:Z,groupId2:ee,groupId3:te},stitch_projectionTypeAffine:{id:551,name:"Affine",groupId:Z,groupId2:ee,groupId3:te},stitch_projectionTypeStereographic:{id:555,name:"Stereographic",groupId:Z,groupId2:ee,groupId3:te},stitch_projectionTypeRectilinear:{id:556,name:"Rectilinear",groupId:Z,groupId2:ee,groupId3:te},stitch_projectionTypeRectilinearPortrait:{id:557,name:"Rectilinear portrait",groupId:Z,groupId2:ee,groupId3:te},stitch_projectionTypePanini:{id:558,name:"Panini",groupId:Z,groupId2:ee,groupId3:te},stitch_projectionTypeRectilinearA2B1:{id:562,name:"Rectilinear A2B1",groupId:Z,groupId2:ee,groupId3:te},stitch_projectionTypeRectilinearPortraitA2B1:{id:563,name:"Rectilinear p. A2B1",groupId:Z,groupId2:ee,groupId3:te},stitch_projectionTypePaniniA2B1:{id:564,name:"Panini A2B1",groupId:Z,groupId2:ee,groupId3:te},stitch_projectionTypePaniniPortraitA2B1:{id:565,name:"Panini portrait A2B1",groupId:Z,groupId2:ee,groupId3:te},bat_none:{id:701,name:"None",groupId:re},bat_ray:{id:702,name:"Ray",groupId:re},bat_rayBlacklist:{id:703,name:"Ray blacklist",groupId:re},bat_rayConfidenceStep:{id:704,name:"Ray step confidence",groupId:re},bat_rayMinTiles:{id:705,name:"Ray min. tiles",groupId:re},bat_reproj:{id:706,name:"Reprojection",groupId:re},bat_reprojCap200:{id:707,name:"Reproj. cap 200",groupId:re},bat_reprojMinTiles:{id:708,name:"Reproj. min. tiles",groupId:re},bat_reprojNoCam:{id:709,name:"Reproj. nce",groupId:re},bat_reprojNoCamCap200:{id:710,name:"Reproj. nce 200",groupId:re},waveCorrectionType_A:{id:611,name:"Auto",groupId:ne},waveCorrectionType_N:{id:612,name:"None",groupId:ne},waveCorrectionType_H:{id:613,name:"Horizontal",groupId:ne},waveCorrectionType_V:{id:614,name:"Vertical",groupId:ne},blendType_none:{id:574,name:"None",groupId:ae},blendType_multiBand:{id:575,name:"Multiband",groupId:ae},blendType_feather:{id:576,name:"Feather",groupId:ae},seamFinderType_Vornoi:{id:578,name:"Vornoi",groupId:ie},seamFinderType_Graphcut:{id:579,name:"Graphcut (slow)",groupId:ie},multiStitch_projectionType:{id:te,name:"Surface projection",groupId:W.multiStitcherCamera.id},multiStitch_bundleAdjust:{id:re,name:"Bundle adjustement type",groupId:W.multiStitcherCamera.id},multiStitch_waveCorrection:{id:ne,name:"Wave correction",groupId:W.multiStitcherCamera.id},multiStitch_camEstimate:{id:582,name:"Cam estimation",groupId:W.multiStitcherCamera.id},multiStitch_maxRectangle:{id:603,name:"Crop to max rect",groupId:W.multiStitcherImage.id},multiStitch_exposureCompensator:{id:590,name:"Exp compens. (slow)",groupId:W.multiStitcherImage.id},multiStitch_colorTransfer:{id:586,name:"Color transfer",groupId:W.multiStitcherImage.id},multiStitch_seamBlend:{id:585,name:"Seam blend",groupId:W.multiStitcherSeams.id},multiStitch_blendStrength:{id:592,name:"Blend strength",groupId:W.multiStitcherSeams.id,enabledIfId:585},multiStitch_seamFinderType:{id:ie,name:"Seam finder",groupId:W.multiStitcherSeams.id},multiStitch_warpFirst:{id:580,name:"Warp first",groupId:W.multiStitcherStitchOrder.id},multiStitch_calcCenterImage:{id:588,name:"Estimate start image",groupId:W.multiStitcherStitchOrder.id,enabledIfId:580},multiStitch_rectifyPerspective:{id:581,name:"Rectify perspective",groupId:W.multiStitcherStitchOrder.id},multiStitch_rectifyStretch:{id:593,name:"Rectify stretch",groupId:W.multiStitcherStitchOrder.id,enabledIfId:581},multiStitch_confidenceThresh:{id:589,name:"Thresh stitching",groupId:W.multiStitcherConfidence.id},multiStitch_inputImagesMatchReach:{id:720,name:"Image match reach",groupId:W.multiStitcherConfidence.id},multiStitch_preserveAlphaChannelValue:{id:600,name:"Preserve Alpha Channel",groupId:W.multiStitcherMemory.id},multiStitch_disposeInputImages:{id:598,name:"Dispose input before stitching",groupId:W.multiStitcherMemory.id},multiStitch_limitResultPreview:{id:596,name:"Max result view size",groupId:W.multiStitcherMemory.id},multiStitch_limitInputView:{id:597,name:"Max input view size",groupId:W.multiStitcherMemory.id},multiStitch_limitLiveStitchingPreview:{id:599,name:"Max temp result size",groupId:W.multiStitcherMemory.id},multiStitch_liveUpdateCycle:{id:601,name:"Live update cycle",groupId:W.multiStitcherMemory.id}}),ue=Object.freeze([{id:oe.sift_featuresN.id,text:"The number of best features to retain (may include location duplicates). The features are ranked by their scores (measured in SIFT algorithm as the local contrast). Value 0 => Automatic."},{id:oe.sift_octaveLayersN.id,text:"The number of layers in each octave. 3 is the value used in D. Lowe paper. The number of octaves is computed automatically from the image resolution."},{id:oe.sift_contrastThresh.id,text:"The contrast threshold used to filter out weak features in semi-uniform (low-contrast) regions. The larger the threshold, the less features are produced by the detector."},{id:oe.sift_edgeThresh.id,text:"The threshold used to filter out edge-like features. Note that the its meaning is different from the contrastThreshold, i.e. the larger the edgeThreshold, the less features are filtered out (more features are retained)."},{id:oe.sift_sigma.id,text:"The sigma of the Gaussian applied to the input image at the octave. If your image is captured with a weak camera with soft lenses, you might want to reduce the number."},{id:oe.surf_hessianThresh.id,text:"Threshold for hessian keypoint detector."},{id:oe.surf_octavesN.id,text:"Number of pyramid octaves the keypoint detector will use."},{id:oe.surf_octaveLayersN.id,text:"Number of octave layers within each octave."},{id:oe.surf_extended.id,text:"On - use extended 128-element descriptors, off - use 64-element descriptors."},{id:oe.orb_featuresN.id,text:"The maximum number of features to retain."},{id:oe.orb_scale.id,text:"Pyramid decimation ratio, greater than 1. scaleFactor==2 means the classical pyramid, where each next level has 4x less pixels than the previous, but such a big scale factor will degrade feature matching scores dramatically. On the other hand, too close to 1 scale factor will mean that to cover certain scale range you will need more pyramid levels and so the speed will suffer."},{id:oe.orb_levelsN.id,text:"The number of pyramid levels."},{id:oe.orb_edgeThresh.id,text:"This is size of the border where the features are not detected. It should NaN"},{id:oe.orb_patchSize.id,text:"size of the patch used by the oriented BRIEF descriptor. Of course, on smaller pyramid layers the perceived image area covered by a feature will be larger."},{id:oe.brisk_thresh.id,text:"AGAST detection threshold score."},{id:oe.brisk_octavesN.id,text:"Detection octaves. Use 0 to do single scale."},{id:oe.brisk_patternScale.id,text:"Apply this scale to the pattern used for sampling the neighbourhood of a keypoint."},{id:oe.kaze_thresh.id,text:"Detector response threshold to accept point."},{id:oe.kaze_octavesN.id,text:"Maximum octave evolution of the image."},{id:oe.kaze_octaveLayersN.id,text:"Default number of sublevels per scale level."},{id:oe.akaze_thresh.id,text:"Detector response threshold to accept point."},{id:oe.akaze_octavesN.id,text:"Maximum octave evolution of the image."},{id:oe.akaze_octaveLayersN.id,text:"Default number of sublevels per scale level."},{id:oe.matchFilterSpreadAuto.id,text:"If enabled, the spread factor will be chosen automatically."},{id:oe.matchFilterSpreadFactor.id,text:"When two detected features are compared, a match distance is calculated. The larger this distance, the less similar the features are. The spread factor is a value to influence how large the distance between two features can be, while the features are still considered to be a good match."},{id:oe.matchFilterMinMatchesToRetain.id,text:"The minimum number of matches to retain (if possible). These matches are then used to align the image to the template image (calculation of the homography matrix)."},{id:oe.matchFilterMaxMatchesToRetain.id,text:"The maximum number of matches to retain. These matches are then used to align the image to the template image (calculation of the homography matrix)."},{id:oe.floodFillTolerance.id,text:"Tolerance value for the flood fill algorithm. After matching two images,  and selecting one or multiple points in an input image, a flood fill image  can be calculated via the select menu."},{id:oe.alignSelectionOverlay.id,text:"Overlay the aligned selection onto the template image."},{id:oe.logInfoEnabled.id,text:"Enabled or disable verbose console logging."},{id:oe.logErrorEnabled.id,text:"Enabled or disable logging of errors."},{id:oe.logAssertEnabled.id,text:"Enabled or disable logging of assertions."},{id:oe.logExternEnabled.id,text:"Enabled or disable logging of extern messages."},{id:oe.imageCap.id,text:"The maxium number of pixels for feature detection. If an image is larger it will be resized before the feature detection runs. This has an impact on the amount of time feature detection consumes."},{id:oe.imageCapInput.id,text:"The maxium size of input images in pixels"},{id:oe.stitch_projection.id,text:"Surface projection for template image."},{id:oe.stitch_projection2.id,text:"Surface projection for image to align."},{id:oe.stitch_seamBlend.id,text:"Blend seam between images."},{id:oe.stitch_colorTransfer.id,text:"Try to adjust the colors of the image to align to the colors of the templte image. Does not work for black and white images."},{id:oe.stitch_fieldOfView1.id,text:"Field of view in the degrees of the template image. Leave empty to use default value or data from image meta data if available."},{id:oe.stitch_yaw1.id,text:"Horizontal orientation of template image in degrees. Leave empty to use default value."},{id:oe.stitch_pitch1.id,text:"Vertical orientation of template image in degrees. Leave empty to use default value."},{id:oe.stitch_fieldOfView2.id,text:"Field of view in the degrees of the image to align. Leave empty to use default value or data from image meta data if available."},{id:oe.stitch_yaw2.id,text:"Horizontal orientation of the image to align in degrees. Leave empty to use default value."},{id:oe.stitch_pitch2.id,text:"Vertical orientation of the image to align in degrees. Leave empty to use default value."},{id:oe.stitch_yaw2Auto.id,text:"Unused."},{id:oe.stitch_pitch2Auto.id,text:"Unused."},{id:oe.multiStitch_projectionType.id,text:"Surface projection."},{id:oe.multiStitch_bundleAdjust.id,text:"Bundle adjustement type. Automatically refines initial camera parameters."},{id:oe.multiStitch_camEstimate.id,text:"Tries to guess camera paramters (focal length and rotation)Rotation parameters are only used if bundle adjustement is enabled."},{id:oe.multiStitch_waveCorrection.id,text:"Tries to straighten a curved panorama/horizon."},{id:oe.multiStitch_colorTransfer.id,text:"Tries to adjust the colors of the images with the purpose that all images have the same color tone. The first image in the stitching pipeline is used as template. This usually does not work with with black and white images."},{id:oe.multiStitch_calcCenterImage.id,text:"Calculate a center image and start stitching from there."},{id:oe.multiStitch_confidenceThresh.id,text:"When calculating a mapping between two images, a confidence value indicates how good the mapping is. Mappings with a confidence value lower than this value are dismissed."},{id:oe.multiStitch_limitResultPreview.id,text:'To save memory, the display stitched result image may be shown only in a reduced resolution. The full resolution image can still be saved via the "save image button".'},{id:oe.multiStitch_limitInputView.id,text:"To save memory, the displayed input images may be resized and displayed with a lower resolution. This has no influence on the final stitching result."},{id:oe.multiStitch_disposeInputImages.id,text:"To save memory, before the stitching process is started, all input images are disposed and only a small preview is kept. This has no influence on the final stitching result. If the stitching process is restarted with the same images though, the images will have to be reloaded (this is done automatically)."},{id:oe.multiStitch_limitLiveStitchingPreview.id,text:"To save memory and increase performance, the preview during stitching can be reduces in size.This has no influence on the final stitching result."},{id:oe.multiStitch_preserveAlphaChannelValue.id,text:"To save memory while blending, preserving of alpha channel values can be disabled.The final stitching result is only influeces if images containing non opaque areas are stitched together."},{id:oe.multiStitch_inputImagesMatchReach.id,text:"Considers the order of input images. Two images are only considered for a match if the index distance is lower or equal than this value. A value of 0 is interpreted as infinite value. Example: The input image at position 3 and the input images at position 7 have an index distance of 4."}]),ce=function(){function e(){Object(z["a"])(this,e)}return Object(G["a"])(e,null,[{key:"_getParam",value:function(e){var t=Object.keys(oe).find((function(t){return oe[t].id==e}));if(!t)throw new Error("No param with id ".concat(e," exists"));return oe[t]}},{key:"getParamName",value:function(e){return this._getParam(e).name}},{key:"getParamGroupId",value:function(e){return this._getParam(e).groupId}},{key:"getParamText",value:function(e){var t=ue.find((function(t){return t.id==e}));return t?t.text:""}},{key:"getParamEnabledIfId",value:function(e){var t=this._getParam(e);return t&&t.enabledIfId?t.enabledIfId:null}},{key:"getParamDisabledIfId",value:function(e){var t=this._getParam(e);return t&&t.disabledIfId?t.disabledIfId:null}}])}(),le=Object.freeze({discrete:1,multiple:2,range:3,rangeSquareRoot:4,number:5,bool:6,numberAuto:7}),me={name:"MultiStitcher",components:{AppImageResult:j,AppMultiInputImages:k,AppCameraCapture:N},created:function(){this.$store.dispatch("multiInput/init"),this.$store.dispatch("worker/load"),this.loadHistoryFromStorage(),this.loadGalleryFromStorage()},computed:{multiStitchName:function(){return $},selectedIndices:function(){return this.$store.getters["multiInput/indicesSelected"]},fieldOfView:function(){return this.selectedIndices.length>0?this.$store.getters["multiInput/imageFieldOfView"](this.selectedIndices[0])+"":""},fieldOfViewDefaultValue:function(){return this.selectedIndices.length>0?this.$store.getters["multiInput/imageFieldOfViewInitial"](this.selectedIndices[0])+"":""},resultValid:function(){return this.$store.getters["worker/results/imageDataValid"]($)},errorText:function(){var e=this.$store.getters["worker/error"];return e&&e.message?e.message:"No match found!"},detTypeName:function(){return ce.getParamName(this.$store.getters["settings/param"](oe.detType.id))},camEstimationOn:function(){return this.$store.getters["settings/param"](oe.multiStitch_camEstimate.id)},friendlyErrorMessage:function(){var e=this.$store.getters["worker/error"];return e&&e.message?e.message.includes("No match found")?"Could not connect the photos together. Try taking photos with more overlap between them.":e.message:"Something went wrong. Please try again."}},data:function(){return{history:[]}},methods:{multiStitch:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$store.dispatch("multiInput/reloadFilesFromDiscIf");case 2:return e.next=4,this.$store.dispatch("worker/computeMultiStitchImageInSteps",{images:this.$store.getters["multiInput/imageDataArray"],fieldsOfView:this.$store.getters["multiInput/imageFieldOfViewArray"],settings:this.$store.getters["settings/settings"]});case 4:this.$store.getters["worker/results/imageDataValid"]($)&&(t={id:Date.now(),imageUrl:this.$store.getters["worker/results/imageDataUrl"]($),sourceImages:Object(y["a"])(this.$store.getters["multiInput/imageDataUrlsArray"]),timestamp:(new Date).toLocaleString()},this.history.unshift(t),this.history.length>2&&this.history.pop(),this.saveHistoryToStorage());case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),deleteWorkerData:function(){this.$store.dispatch("worker/multiStitchResetWorkerData")},deleteResult:function(){this.$store.commit("worker/results/imageData",{name:$,imageData:null})},deleteAllOrSelectedInputImages:function(){this.$store.dispatch("multiInput/removeAllOrSelected"),this.deleteWorkerData(),this.saveGalleryToStorage()},swapImagesInputImages:function(e){var t=e.indexFrom,r=e.indexTo;this.$store.commit("multiInput/swap",{indexFrom:t,indexTo:r}),this.deleteWorkerData()},saveImage:function(){this.$store.dispatch("worker/saveResultImage",{name:$,imageFileName:"MultiStitcherImage.png"})},multiInputFilesChanged:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.deleteWorkerData(),e.next=3,this.$store.dispatch("multiInput/imageFiles",t);case 3:this.saveGalleryToStorage();case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),setFieldOfView:function(e){var t=this;this.selectedIndices.forEach((function(r){e?t.$store.commit("multiInput/imageFieldOfViewUpdate",{index:r,fieldOfView:+e}):t.$store.commit("multiInput/imageFieldOfViewUpdate",{index:r,fieldOfView:t.$store.getters["multiInput/imageFieldOfViewInitial"](r)})}))},openFileSelector:function(){this.$refs.fileInput.click()},handleFileSelect:function(e){e.target.files&&e.target.files.length>0&&(this.multiInputFilesChanged(Array.from(e.target.files)),e.target.value="")},handleCameraCapture:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.multiInputFilesChanged([t]);case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),handleCameraError:function(e){"NotAllowedError"===e.name||"NotFoundError"===e.name?this.$store.commit("logs/addErrorMessage","Could not access camera. Please check permissions."):this.$store.commit("logs/addErrorMessage","Camera error: ".concat(e.name))},startCamera:function(){this.$refs.camera?this.$refs.camera.start():this.$store.commit("logs/addErrorMessage","Camera initialization failed. Please try again.")},loadHistoryFromStorage:function(){try{var e=localStorage.getItem("panoramaHistory");e&&(this.history=JSON.parse(e))}catch(t){this.$store.commit("logs/addErrorMessage","Failed to load panorama history")}},saveHistoryToStorage:function(){try{localStorage.setItem("panoramaHistory",JSON.stringify(this.history))}catch(e){this.$store.commit("logs/addErrorMessage","Failed to save panorama history")}},deleteSelectedInputImages:function(){this.$store.dispatch("multiInput/removeAllOrSelected"),this.deleteWorkerData(),this.saveGalleryToStorage()},loadGalleryFromStorage:function(){try{var e=localStorage.getItem("galleryImages");if(e){var t=JSON.parse(e);t.images&&t.images.length>0&&this.$store.dispatch("multiInput/imageFiles",t.images)}}catch(r){this.$store.commit("logs/addErrorMessage","Failed to load gallery images")}},saveGalleryToStorage:function(){try{var e=this.$store.getters["multiInput/imageDataArray"];localStorage.setItem("galleryImages",JSON.stringify({images:e}))}catch(t){this.$store.commit("logs/addErrorMessage","Failed to save gallery images")}}}},de=me,ge=(r("fdf1"),Object(m["a"])(de,h,f,!1,null,"90f88b02",null)),pe=ge.exports;a["a"].use(p["a"]);var he=new p["a"]({mode:"history",base:"/imgalign/",routes:[{path:"/",name:"home",component:pe,meta:{title:"Store Aisle Scanner"}},{path:"*",redirect:"/"}]}),fe=r("2f62"),ye=r("bd86"),ve=function(){function e(){Object(z["a"])(this,e)}return Object(G["a"])(e,null,[{key:"imageDataFromImageSrc",value:function(e){var t=new Date,r=document.createElement("canvas");r.width=e.width,r.height=e.height;var a=r.getContext("2d");a.drawImage(e,0,0,e.width,e.height);var i=a.getImageData(0,0,r.width,r.height);return console.log("[imageDataFromImageSrc][time][ms]",new Date-t),i}},{key:"imageSrcFromImageData",value:function(e){var t=new Date,r=document.createElement("canvas"),a=r.getContext("2d");r.width=e.width,r.height=e.height,a.putImageData(e,0,0);var i=r.toDataURL();return console.log("[imageSrcFromImageData][toDataURL][time][ms]",new Date-t),i}},{key:"imageBlobFromImageData",value:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t){var r,a,i,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=new Date,a=document.createElement("canvas"),i=a.getContext("2d"),a.width=t.width,a.height=t.height,i.putImageData(t,0,0),e.next=8,new Promise((function(e){try{a.toBlob((function(t){return e(t)}),"image/png",1)}catch(t){console.log("[imageBlobFromImageData][toBlob][Error]",t),e(null)}}));case 8:return n=e.sent,console.log("[imageBlobFromImageData][toBlob][time][ms]",new Date-r),e.abrupt("return",n);case 11:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()}])}(),be=15,we=(Object.freeze({pathColor:"#ff9999ff",pathColor1:"#000000ff",pathColor2:"#ffffffff",pathWidth:2,pathWidth1:4,pathWidth2:2,ptColor:"#5555ffff",ptColor1:"#000000ff",ptColor2:"#ffffffff",ptStartColor:"#ff5555ff",ptStartColor1:"#ffffffff",ptStartColor2:"#000000ff",fillColor:"#0000ff44",ptRadius:3,ptRadius1:4,ptRadius2:2}),r("6f45")),Ie=function(){function e(){Object(z["a"])(this,e)}return Object(G["a"])(e,null,[{key:"getFieldOfViewAsync",value:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){we["getData"](t,(function(){var t=this,r=we["getTag"](this,"FocalLengthIn35mmFilm");if(r){var a=Number(r);if(!isNaN(a)){var i=function(){var e=we["getTag"](t,"ImageWidth"),r=we["getTag"](t,"ImageHeight"),a=we["getTag"](t,"PixelXDimension"),i=we["getTag"](t,"PixelYDimension");if(a&&(e=a),i&&(r=i),!e||!r)return null;var n=Number(e);if(isNaN(n))return null;var s=Number(r);return isNaN(s)?null:e/r};if(a){var n=6300/(Math.PI*a),s=i();return s&&s<1&&(n*=s),void e(Math.round(n))}}}e(null)}))})));case 1:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()}])}(),_e=r("5c22"),xe=r.n(_e),ke=r("5fba"),Se=r.n(ke);r("ac4d"),r("8a81"),r("6b54"),r("9278"),r("87f3");function De(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Ae(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var a=0,i=function(){};return{s:i,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,s=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,n=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw n}}}}function Ae(e,t){if(e){if("string"==typeof e)return Oe(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Oe(e,t):void 0}}function Oe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=Array(t);r<t;r++)a[r]=e[r];return a}var Te=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Object(z["a"])(this,e),this._pts=t}return Object(G["a"])(e,[{key:"addPt",value:function(e){this._pts.push(e)}},{key:"addPtAndCloseIf",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this.pts.length<3)this.addPt(e);else{var r=this.pts[0],a=r.x,i=r.y;Math.pow(Math.abs(a-e.x),2)+Math.pow(Math.abs(i-e.y),2)<Math.pow(t,2)?this.addPt({x:a,y:i}):this.addPt(e)}}},{key:"isClosed",value:function(){return this.pts.length>3&&this.pts[0].x==this.pts[this.pts.length-1].x&&this.pts[0].y==this.pts[this.pts.length-1].y}},{key:"clear",value:function(){this._pts=[]}},{key:"pts",get:function(){return this._pts}},{key:"bbox",get:function(){for(var e={x:Number.MAX_SAFE_INTEGER,y:Number.MAX_SAFE_INTEGER},t={x:Number.MIN_SAFE_INTEGER,y:Number.MIN_SAFE_INTEGER},r=0;r<this.pts.length;++r){var a=this.pts[r];a.x<e.x&&(e.x=a.x),a.x>t.x&&(t.x=a.x),a.y<e.y&&(e.y=a.y),a.y>t.y&&(t.y=a.y)}return{tl:e,br:t}}},{key:"scaledCopy",value:function(t){var r,a=new e,i=De(this.pts);try{for(i.s();!(r=i.n()).done;){var n=r.value;a.addPt({x:n.x*t,y:n.y*t})}}catch(s){i.e(s)}finally{i.f()}return a}}])}();function Re(e,t,r){e.commit("imageFieldOfView",{name:t,fieldOfView:r}),t==E?e.dispatch("settings/param",{id:oe.stitch_fieldOfView1.id,value:r},{root:!0}):t==B&&e.dispatch("settings/param",{id:oe.stitch_fieldOfView2.id,value:r},{root:!0})}function je(e,t,r){e.commit("imageProjected",{name:t,projected:r}),r&&(t==E?e.dispatch("settings/param",{id:oe.stitch_projection.id,value:oe.stitch_projectionTypeNone.id},{root:!0}):t==B&&e.dispatch("settings/param",{id:oe.stitch_projection2.id,value:oe.stitch_projectionTypeNone.id},{root:!0}))}var Ce={imageData:Object(ye["a"])(Object(ye["a"])({},E,null),B,null),imageDataUrls:Object(ye["a"])(Object(ye["a"])({},E,null),B,null),imageFieldOfView:Object(ye["a"])(Object(ye["a"])({},E,null),B,null),imageProjected:Object(ye["a"])(Object(ye["a"])({},E,!1),B,!1),polygons:Object(ye["a"])(Object(ye["a"])({},E,new Te),B,new Te),floodFillTolerances:Object(ye["a"])(Object(ye["a"])({},E,[]),B,[]),busy:Object(ye["a"])(Object(ye["a"])({},E,!1),B,!1)},Fe={imageData:function(e){return function(t){return e.imageData[t]}},imageDataUrl:function(e,t){return function(r){return t["imageDataValid"](r)?e.imageDataUrls[r]:null}},imageDataValid:function(e){return function(t){return e.imageData[t]&&e.imageData[t].width>0&&e.imageData[t].height>0}},allImageDataValid:function(e,t){return t["imageDataValid"](E)&&t["imageDataValid"](B)},allImageNames:function(){return[E,B]},imageFieldOfView:function(e){return function(t){return e.imageFieldOfView[t]}},imageProjected:function(e){return function(t){return e.imageProjected[t]}},polygons:function(e){return e.polygons},polygon:function(e){return function(t){return e.polygons[t]}},polygonClosedPts:function(e){return function(t){var r=e.polygons[t];return r.isClosed()?r.pts:[]}},polygonClosedPtsFixedImage:function(e){return e.polygons[E].isClosed()?e.polygons[E].pts:[]},polygonClosedPtsMovingImage:function(e){return e.polygons[B].isClosed()?e.polygons[B].pts:[]},pt:function(e){return function(t){var r=e.polygons[t].pts.length;return 0==r||e.polygons[t].isClosed()?null:e.polygons[t].pts[r-1]}},ptFixedImage:function(e){var t=e.polygons[E].pts.length;return 0==t||e.polygons[E].isClosed()?null:e.polygons[E].pts[t-1]},ptMovingImage:function(e){var t=e.polygons[B].pts.length;return 0==t||e.polygons[B].isClosed()?null:e.polygons[B].pts[t-1]},pathPts:function(e){return function(t){return 0==e.polygons[t].pts.length?[]:e.polygons[t].isClosed()?e.polygons[t].pts.slice(1):e.polygons[t].pts}},pathPtsFixedImage:function(e){var t=e.polygons[E];return 0==t.pts.length?[]:t.isClosed()?t.pts.slice(1):t.pts},pathPtsMovingImage:function(e){var t=e.polygons[B];return 0==t.pts.length?[]:t.isClosed()?t.pts.slice(1):t.pts},floodFillTolerances:function(e){return function(t){return 0==e.floodFillTolerances[t].length?[]:e.polygons[t].isClosed()?e.floodFillTolerances[t].slice(1):e.floodFillTolerances[t]}},busy:function(e){return function(t){return e.busy[t]}},busyFixedImage:function(e){return e.busy[E]},busyMovingImage:function(e){return e.busy[B]},busyAny:function(e){return e.busy[E]||e.busy[B]}},Pe={imageData:function(e,t){var r=t.name,a=t.imageData;e.imageData[r]=a},_imageDataUrl:function(e,t){var r=t.name,a=t.imageDataUrl;e.imageDataUrls[r]=a},imageFieldOfView:function(e,t){var r=t.name,a=t.fieldOfView;e.imageFieldOfView[r]=a},imageProjected:function(e,t){var r=t.name,a=t.projected;e.imageProjected[r]=a},addPolygonPt:function(e,t){var r=t.name,a=t.pt,i=t.floodFillTolerance;e.polygons[r].isClosed()?(e.polygons[r]=new Te,e.floodFillTolerances[r]=[]):(e.polygons[r].addPtAndCloseIf(a,be),e.floodFillTolerances[r].push(i||0===i?i:10))},resetPolygon:function(e,t){e.polygons[t]=new Te,e.floodFillTolerances[t]=[]},busy:function(e,t){var r=t.name,a=t.value;e.busy[r]=a}},Ve={loadDefaultImages:function(e,t){for(var r=[{name:E,dataUrl:t?t.url1:xe.a},{name:B,dataUrl:t?t.url2:Se.a}],a=function(){var t=n[i],r=t.name,a=t.dataUrl,s=new Image;s.onload=function(){try{var t=ve.imageDataFromImageSrc(s);e.dispatch("imageData",{name:r,imageData:t,doResizeIf:!1}),s.onload=null}finally{e.commit("busy",{name:r,value:!1})}},a&&(s.src=a,e.commit("busy",{name:r,value:!0}))},i=0,n=r;i<n.length;i++)a()},init:function(e,t){e.getters["imageDataValid"](E)||e.getters["imageDataValid"](B)||e.dispatch("loadDefaultImages",t)},imageData:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t,r){var a,i,n,s,o,u,c,l,m,d,g;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=t.commit,i=t.dispatch,n=t.rootGetters,s=r.name,o=r.imageData,u=r.doResizeIf,c=void 0===u||u,!(c&&o&&n["worker/ready"])){e.next=12;break}if(l=n["settings/param"](oe.imageCapInput.id),!(o.width*o.height>l)){e.next=12;break}if(m=Math.sqrt(l/(o.width*o.height)),d=Math.floor(o.height*m),g=Math.floor(o.width*m),!n["worker/ready"]){e.next=11;break}return e.next=11,i("worker/setInputImageResized",{imageName:s,imageDataSrc:o,width:g,height:d},{root:!0});case 11:return e.abrupt("return");case 12:a("imageData",{name:s,imageData:o}),i("_imageDataUrl",{name:s,imageData:o}),a("resetPolygon",s),a("imageFieldOfView",{name:s,fieldOfView:null}),a("imageProjected",{name:s,projected:!1}),n["worker/ready"]&&(i("worker/resetWorkerData",null,{root:!0}),a("worker/results/imageData",{name:L,imageData:null},{root:!0}),a("worker/results/imageData",{name:U,imageData:null},{root:!0}),a("worker/results/imageData",{name:q,imageData:null},{root:!0}));case 18:case"end":return e.stop()}}),e)})));function t(t,r){return e.apply(this,arguments)}return t}(),_imageDataUrl:function(e,t){var r=e.commit,a=t.name,i=t.imageData;r("_imageDataUrl",i?{name:a,imageDataUrl:ve.imageSrcFromImageData(i)}:{name:a,imageDataUrl:null})},imageFile:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t,r){var a,i,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:a=r.name,i=r.file,n=new Image,n.onload=Object(v["a"])(regeneratorRuntime.mark((function e(){var r,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,r=ve.imageDataFromImageSrc(n),e.next=4,t.dispatch("imageData",{name:a,imageData:r});case 4:return e.next=6,Ie.getFieldOfViewAsync(n);case 6:i=e.sent,i&&Re(t,a,i),n.onload=null;case 9:return e.prev=9,t.commit("busy",{name:a,value:!1}),e.finish(9);case 12:case"end":return e.stop()}}),e,null,[[0,,9,12]])}))),i&&(t.commit("busy",{name:a,value:!0}),n.src=URL.createObjectURL(i));case 4:case"end":return e.stop()}}),e)})));function t(t,r){return e.apply(this,arguments)}return t}(),imageUrlBase64:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t,r){var a,i,n,s,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:a=r.name,i=r.url,n=r.fieldOfView,s=r.projected,o=new Image,o.onload=Object(v["a"])(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,r=ve.imageDataFromImageSrc(o),e.next=4,t.dispatch("imageData",{name:a,imageData:r});case 4:if(n){e.next=8;break}return e.next=7,Ie.getFieldOfViewAsync(o);case 7:n=e.sent;case 8:n&&Re(t,a,n),s&&je(t,a,s),o.onload=null;case 11:return e.prev=11,t.commit("busy",{name:a,value:!1}),e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[0,,11,14]])}))),i&&(t.commit("busy",{name:a,value:!0}),o.src=i);case 4:case"end":return e.stop()}}),e)})));function t(t,r){return e.apply(this,arguments)}return t}()},Me={namespaced:!0,state:Ce,getters:Fe,mutations:Pe,actions:Ve},Ne=(r("6c7b"),r("20d6"),{imageDataArray:[],imageDataKeysArray:[],imageDataUrlsArray:[],imageFileArray:[],imageFieldOfViewArray:[],imageFieldOfViewInitialArray:[],busy:!1,busyLoading:!1,indicesSelected:[],initCalled:!1,error:null}),Ee={imageDataArray:function(e){return e.imageDataArray},imageDataKeyArray:function(e){return e.imageDataKeysArray},imageDataUrlsArray:function(e){return e.imageDataUrlsArray},imageFileArray:function(e){return e.imageFileArray},imageFieldOfViewArray:function(e){return e.imageFieldOfViewArray},busy:function(e){return e.busy},busyLoading:function(e){return e.busyLoading},indicesSelected:function(e){return e.indicesSelected},imageFieldOfView:function(e){return function(t){return e.imageFieldOfViewArray[t]}},imageFieldOfViewInitial:function(e){return function(t){return e.imageFieldOfViewInitialArray[t]}},imageDataValid:function(e){return function(t){return e.imageDataArray.length>t&&e.imageDataArray[t]&&e.imageDataArray[t].width>0&&e.imageDataArray[t].height>0||e.imageFileArray.length>t&&e.imageFileArray[t]}},imageCount:function(e){return e.imageDataArray.length},initCalled:function(e){return e.initCalled},error:function(e){return e.error}},Be={imageDataArray:function(e,t){e.imageDataArray=t},imageData:function(e,t){e.imageDataArray.push(t),e.imageDataKeysArray.push(Math.random())},_imageDataUrl:function(e,t){e.imageDataUrlsArray.push(t)},_imageFile:function(e,t){e.imageFileArray.push(t)},imageFieldOfView:function(e,t){e.imageFieldOfViewArray.push(t)},imageFieldOfViewInitial:function(e,t){e.imageFieldOfViewInitialArray.push(t)},imageDataUrlsArray:function(e,t){e.imageDataUrlsArray=t},imageFieldOfViewUpdate:function(e,t){var r=t.index,a=t.fieldOfView;e.imageFieldOfViewArray.splice(r,1,a)},imageClicked:function(e,t){if(-1!=t){var r=e.indicesSelected.findIndex((function(e){return e==t}));-1==r?e.indicesSelected.push(t):e.indicesSelected.splice(r,1)}else e.indicesSelected=[]},busy:function(e,t){e.busy=t},busyLoading:function(e,t){e.busyLoading=t},swap:function(e,t){var r=t.indexFrom,a=t.indexTo,i=e.imageDataArray[a],n=e.imageDataKeysArray[a],s=e.imageDataUrlsArray[a],o=e.imageFileArray[a],u=e.imageFieldOfViewArray[a],c=e.imageFieldOfViewInitialArray[a];e.imageDataArray.splice(a,1,e.imageDataArray[r]),e.imageDataKeysArray.splice(a,1,e.imageDataKeysArray[r]),e.imageDataUrlsArray.splice(a,1,e.imageDataUrlsArray[r]),e.imageFileArray.splice(a,1,e.imageFileArray[r]),e.imageFieldOfViewArray.splice(a,1,e.imageFieldOfViewArray[r]),e.imageFieldOfViewInitialArray.splice(a,1,e.imageFieldOfViewInitialArray[r]),e.imageDataArray.splice(r,1,i),e.imageDataKeysArray.splice(r,1,n),e.imageDataUrlsArray.splice(r,1,s),e.imageFileArray.splice(r,1,o),e.imageFieldOfViewArray.splice(r,1,u),e.imageFieldOfViewInitialArray.splice(r,1,c)},removeSelected:function(e){e.imageDataArray=e.imageDataArray.filter((function(t,r){return!e.indicesSelected.some((function(e){return e==r}))})),e.imageDataKeysArray=e.imageDataKeysArray.filter((function(t,r){return!e.indicesSelected.some((function(e){return e==r}))})),e.imageDataUrlsArray=e.imageDataUrlsArray.filter((function(t,r){return!e.indicesSelected.some((function(e){return e==r}))})),e.imageFileArray=e.imageFileArray.filter((function(t,r){return!e.indicesSelected.some((function(e){return e==r}))})),e.imageFieldOfViewArray=e.imageFieldOfViewArray.filter((function(t,r){return!e.indicesSelected.some((function(e){return e==r}))})),e.imageFieldOfViewInitialArray=e.imageFieldOfViewInitialArray.filter((function(t,r){return!e.indicesSelected.some((function(e){return e==r}))})),e.indicesSelected=[]},removeAll:function(e){e.imageDataArray=[],e.imageDataKeysArray=[],e.imageDataUrlsArray=[],e.imageFileArray=[],e.imageFieldOfViewArray=[],e.imageFieldOfViewInitialArray=[],e.indicesSelected=[]},freeImageData:function(e){var t=e.imageDataArray.length;e.imageDataArray=[],e.imageDataArray=new Array(t).fill(null)},initCalled:function(e){e.initCalled=!0},setError:function(e,t){e.error=t}},Le={loadDefaultImages:function(e){var t=e.getters["imageDataArray"];t&&t.length>0&&e.commit("removeAll")},init:function(e){e.getters["initCalled"]||(e.commit("initCalled"),e.dispatch("loadFromStorage"))},imageData:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t,r){var a,i,n,s,o,u,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=t.commit,i=t.dispatch,n=t.rootGetters,!r||!n["worker/ready"]){e.next=11;break}if(s=n["settings/param"](oe.imageCapInput.id),!(r.width*r.height>s)){e.next=11;break}if(o=Math.sqrt(s/(r.width*r.height)),u=Math.floor(r.height*o),c=Math.floor(r.width*o),!n["worker/ready"]){e.next=10;break}return e.next=10,i("worker/setMultiInputImageResized",{imageDataSrc:r,width:c,height:u},{root:!0});case 10:return e.abrupt("return");case 11:return a("imageData",r),e.next=14,i("imageDataUrl",r);case 14:case"end":return e.stop()}}),e)})));function t(t,r){return e.apply(this,arguments)}return t}(),imageDataUrl:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t,r){var a,i,n,s,o,u,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=t.commit,i=t.dispatch,n=t.rootGetters,r){e.next=4;break}return a("_imageDataUrl",null),e.abrupt("return");case 4:if(s=n["settings/param"](oe.multiStitch_limitInputView.id),!(r.width*r.height>s)){e.next=13;break}if(o=Math.sqrt(s/(r.width*r.height)),u=Math.floor(r.height*o),c=Math.floor(r.width*o),!n["worker/ready"]){e.next=12;break}return e.next=12,i("worker/setMultiInputImageUrlResized",{imageDataSrc:r,width:c,height:u},{root:!0});case 12:return e.abrupt("return");case 13:n["worker/ready"]&&a("_imageDataUrl",ve.imageSrcFromImageData(r));case 14:case"end":return e.stop()}}),e)})));function t(t,r){return e.apply(this,arguments)}return t}(),imageFile:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t,r){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t.getters["busy"],e.abrupt("return",new Promise((function(e){var i=new Image;i.onload=Object(v["a"])(regeneratorRuntime.mark((function n(){var s,o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,s=ve.imageDataFromImageSrc(i),n.next=4,t.dispatch("imageData",s);case 4:return t.commit("_imageFile",r),n.next=7,Ie.getFieldOfViewAsync(i);case 7:o=n.sent,o?(t.commit("imageFieldOfView",o),t.commit("imageFieldOfViewInitial",o)):(t.commit("imageFieldOfView",45),t.commit("imageFieldOfViewInitial",45)),i.onload=null,URL.revokeObjectURL(i.src),t.dispatch("saveToStorage");case 12:return n.prev=12,a||t.commit("busy",!1),e(),n.finish(12);case 16:case"end":return n.stop()}}),n,null,[[0,,12,16]])}))),r&&(a||t.commit("busy",!0),i.src=URL.createObjectURL(r))})));case 2:case"end":return e.stop()}}),e)})));function t(t,r){return e.apply(this,arguments)}return t}(),imageFiles:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t,r){var a,i,n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:e.prev=0,t.commit("busy",!0),a=Array.from(r),i=0,n=a;case 4:if(!(i<n.length)){e.next=11;break}return s=n[i],e.next=8,t.dispatch("imageFile",s);case 8:i++,e.next=4;break;case 11:t.dispatch("saveToStorage");case 12:return e.prev=12,t.commit("busy",!1),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[0,,12,15]])})));function t(t,r){return e.apply(this,arguments)}return t}(),removeAllOrSelected:function(e){0==e.getters["indicesSelected"].length?e.commit("removeAll"):e.commit("removeSelected"),e.dispatch("saveToStorage")},reloadFilesFromDisc:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=t.getters["imageFileArray"],t.commit("removeAll"),e.next=4,t.dispatch("imageFiles",r);case 4:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}(),reloadFilesFromDiscIf:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(0!=t.getters["imageFileArray"].length){e.next=2;break}return e.abrupt("return");case 2:if(0!=t.getters["imageDataArray"].length&&null!=t.getters["imageDataArray"][0]){e.next=5;break}return e.next=5,t.dispatch("reloadFilesFromDisc");case 5:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}(),saveToStorage:function(e){var t=e.state,r=e.commit;try{var a={imageDataUrlsArray:t.imageDataUrlsArray,imageFieldOfViewArray:t.imageFieldOfViewArray,imageFieldOfViewInitialArray:t.imageFieldOfViewInitialArray};localStorage.setItem("multiInputState",JSON.stringify(a))}catch(i){r("setError","Failed to save images to storage")}},loadFromStorage:function(e){var t=e.commit;try{var r=localStorage.getItem("multiInputState");if(r){var a=JSON.parse(r),i=a.imageDataUrlsArray,n=a.imageFieldOfViewArray,s=a.imageFieldOfViewInitialArray;i&&i.length>0&&i.forEach((function(e,r){var a=new Image;a.onload=function(){var i=ve.imageDataFromImageSrc(a);t("imageData",i),t("_imageDataUrl",e),t("imageFieldOfView",n[r]||45),t("imageFieldOfViewInitial",s[r]||45)},a.src=e}))}}catch(o){t("setError","Failed to load images from storage")}}},Ue={namespaced:!0,state:Ne,getters:Ee,mutations:Be,actions:Le},qe=r("21a6"),$e=(r("6aa2"),Symbol()),ze=Symbol(),Ge="load",We="init",Ke="params",He="match",Ye="reset",Je="alignedImage",Xe="blendedImage",Qe="stitchedImage",Ze="stitch",et="stitchedImageWithKeyPoints",tt="blendedImagePolygonFixedImage",rt="blendedImagePolygonMovingImage",at="blendedImageFloodFillFixedImage",it="blendedImageFloodFillMovingImage",nt="sideBySideImageGood",st="sideBySideImageGoodInliers",ot="keyPointsFixedImageGood",ut="keyPointsMovingImageGood",ct="keyPointsFixedImageInlier",lt="keyPointsMovingImageInlier",mt="detCompareImage",dt="cInfo",gt="cError",pt="cLog",ht="cAssert",ft="resize",yt="multiStitchInit",vt="multiStitchReset",bt="multiStitchParams",wt="multiStitch",It="multiStitchStart",_t="multiStitchNext",xt=function(){function e(t){if(Object(z["a"])(this,e),t!=ze)throw"Cannot construct Singleton!";this._init()}return Object(G["a"])(e,[{key:"_init",value:function(){var e=this;this.worker=new Worker("js/imgalign.worker.js"),this.worker.onmessage=function(t){return e._handleMessage(t)},this.worker.onerror=function(t){return e._handleError(t)}}},{key:"reInitWorker",value:function(){this.__messageDone=null,this.worker.terminate(),this.__messageAbort&&this.__messageAbort(),this.__messageAbort=null,this._init()}},{key:"postWorkerMessageAsync",value:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t){var r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,a){r.__messageDone=function(){e.apply(void 0,arguments)},r.__messageAbort=function(){a("ignore")},r.__error=function(e){return a(e)},r.worker.postMessage(t)})));case 1:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"resetWorkerDataAsync",value:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.postWorkerMessageAsync({msg:Ye});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"resetMultiStitchWorkerDataAsync",value:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.postWorkerMessageAsync({msg:vt});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadAsync",value:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.postWorkerMessageAsync({msg:Ge,payload:{workerFileName:t}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"_initAsync",value:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.postWorkerMessageAsync({msg:We,payload:{fixedImage:t,movingImage:r}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"_multiStitchInitAsync",value:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.postWorkerMessageAsync({msg:yt,payload:{images:t}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"_matchAsync",value:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.postWorkerMessageAsync({msg:He,payload:{fixedImagePolygonPts:t,movingImagePolygonPts:r}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"_setParams",value:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.postWorkerMessageAsync({msg:Ke,payload:t.filter((function(e){return 301!=e.id}))});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"_multiStitchSetParams",value:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.postWorkerMessageAsync({msg:bt,payload:t.filter((function(e){return 301!=e.id}))});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"_multiStitch",value:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.postWorkerMessageAsync({msg:wt,payload:{fieldsOfView:t}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"_multiStitchStart",value:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.postWorkerMessageAsync({msg:It,payload:{fieldsOfView:t}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"_compareAsync",value:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t,r,a,i){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.postWorkerMessageAsync({msg:mt,payload:{imageType:t,detTypesArr:r,fixedImagePolygonPts:a,movingImagePolygonPts:i}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(t,r,a,i){return e.apply(this,arguments)}return t}()},{key:"compare_requestImageAsync",value:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t,r,a,i,n,s,o){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._initAsync(t,r);case 2:return e.next=4,this._setParams(a);case 4:return e.next=6,this._compareAsync(i,n,s,o);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)})));function t(t,r,a,i,n,s,o){return e.apply(this,arguments)}return t}()},{key:"stitchAsync",value:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t,r,a,i,n,s,o,u,c,l,m,d){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.postWorkerMessageAsync({msg:Ze,payload:{projectionType1:t,projectionType2:r,seamBlend:a,colorTransfer:i,fieldOfViewFixedImage:n,fieldOfViewMovingImage:s,calcRotationYaw2:o,calcRotationPitch2:u,yaw1:c,pitch1:l,yaw2:m,pitch2:d}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(t,r,a,i,n,s,o,u,c,l,m,d){return e.apply(this,arguments)}return t}()},{key:"matchAsync",value:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t,r,a,i,n){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._initAsync(t,r);case 2:return e.next=4,this._setParams(a);case 4:return e.next=6,this._matchAsync(i,n);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)})));function t(t,r,a,i,n){return e.apply(this,arguments)}return t}()},{key:"multiStitch",value:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t,r,a){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._multiStitchInitAsync(t);case 2:return e.next=4,this._multiStitchSetParams(a);case 4:return e.next=6,this._multiStitch(r);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)})));function t(t,r,a){return e.apply(this,arguments)}return t}()},{key:"multiStitchRecompute",value:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._multiStitchSetParams(r);case 2:return e.next=4,this._multiStitch(t);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"multiStitchStart",value:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t,r,a){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._multiStitchInitAsync(t);case 2:return e.next=4,this._multiStitchSetParams(a);case 4:return e.next=6,this._multiStitchStart(r);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)})));function t(t,r,a){return e.apply(this,arguments)}return t}()},{key:"multiStitchNext",value:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.postWorkerMessageAsync({msg:_t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"multiStitchStartRecompute",value:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._multiStitchSetParams(r);case 2:return e.next=4,this._multiStitchStart(t);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"requestAlignedImageAsync",value:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.postWorkerMessageAsync({msg:Je});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"requestBlendedImageAsync",value:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.postWorkerMessageAsync({msg:Xe,payload:{weight:t,doOverlay:r}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"requestStitchedImageAsync",value:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.postWorkerMessageAsync({msg:Qe,payload:{weight:t}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"requestStitchedImageWithKeyPointsAsync",value:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.postWorkerMessageAsync({msg:et,payload:{weight:t}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"requestBlendedImagePolygonAsync",value:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t,r,a,i){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.postWorkerMessageAsync({msg:i?tt:rt,payload:{weight:t,doOverlay:r,polygon:a,isFixedImage:i}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(t,r,a,i){return e.apply(this,arguments)}return t}()},{key:"requestBlendedImageFloodFillAsync",value:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t,r,a,i,n){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.postWorkerMessageAsync({msg:n?at:it,payload:{weight:t,doOverlay:r,pts:a,floodFillTolerances:i,isFixedImage:n}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(t,r,a,i,n){return e.apply(this,arguments)}return t}()},{key:"requestSideBySideImageGoodAsync",value:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.postWorkerMessageAsync({msg:nt});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"requestSideBySideImageGoodInliersAsync",value:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.postWorkerMessageAsync({msg:st});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"requestKeyPointsGoodFixedImageAsync",value:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.postWorkerMessageAsync({msg:ot});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"requestKeyPointsGoodMovingImageAsync",value:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.postWorkerMessageAsync({msg:ut});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"requestKeyPointsInlierFixedImageAsync",value:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.postWorkerMessageAsync({msg:ct});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"requestKeyPointsInlierMovingImageAsync",value:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.postWorkerMessageAsync({msg:lt});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"requestResizedImageAsync",value:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t,r,a){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.postWorkerMessageAsync({msg:ft,payload:{image:t,width:r,height:a}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(t,r,a){return e.apply(this,arguments)}return t}()},{key:"_messageDone",value:function(){this.__messageDone&&(this.__messageDone.apply(this,arguments),this.__messageDone=null)}},{key:"_getImageData",value:function(e){if(0==e.width||0==e.height)return null;var t=new Uint8ClampedArray(e.buf,e.byteOffset,e.bufLen);return new ImageData(t,e.width,e.height)}},{key:"_messageImage",value:function(e){this._messageDone(this._getImageData(e))}},{key:"_messageCompareImage",value:function(e){this._messageDone({imageData:this._getImageData(e),timeUsedArr:e.additionalData.timeUsedArr,keyPointsCountArr:e.additionalData.keyPointsCountArr})}},{key:"_messageStitchedImage",value:function(e){this._messageDone({imageData:this._getImageData(e),fieldOfView:e.additionalData})}},{key:"_messageMultiStitchImage",value:function(e){this._messageDone({imageData:this._getImageData(e),imageDataSmall:e.imageDataSmall?this._getImageData(e.imageDataSmall):null,stitchedImagesN:e.additionalData})}},{key:"_messageMultiStitchImageStart",value:function(e){this._messageDone({imageData:this._getImageData(e),stitchIndices:e.additionalData})}},{key:"_handleMessage",value:function(e){if(!this._handleLogMessages(e.data)){if("done"!=e.data.info)throw new Error("Unknown message info: ".concat(e.data.info));switch(e.data.msg){case Ge:case We:case Ke:case He:case Ye:case yt:case vt:case bt:this._messageDone(e.data.payload);break;case Je:case Xe:case Qe:case et:case tt:case rt:case at:case it:case nt:case st:case ot:case ut:case ct:case lt:case ft:this._messageImage(e.data.payload);break;case It:this._messageMultiStitchImageStart(e.data.payload);break;case mt:this._messageCompareImage(e.data.payload);break;case Ze:this._messageStitchedImage(e.data.payload);break;case wt:case _t:this._messageMultiStitchImage(e.data.payload);break;default:}console.log("[WorkerClient][_handleMessage][".concat(e.data.msg,"][success]"))}}},{key:"_handleError",value:function(e){if(this.__error)this.__error(e),this.__error=null;else{var t="Line: "+(e.lineno?e.lineno:"unknown "),r="File: "+(e.filename?e.filename:"unknown "),a="Message: "+(e.message?e.message:"unknown");console.log("[WorkerClient][_handleError]: "+t+r+a)}}},{key:"_handleLogMessages",value:function(e){var t,r,a,i,n=e.msg,s=e.info,o=e.payload;function u(e,t){return"extern"==e?["opencv"].concat(Object(y["a"])(t)):t}switch(n){case pt:return(t=console).log.apply(t,Object(y["a"])(u(s,o))),!0;case dt:return(r=console).info.apply(r,Object(y["a"])(u(s,o))),!0;case gt:return(a=console).error.apply(a,Object(y["a"])(u(s,o))),!0;case ht:return(i=console).assert.apply(i,Object(y["a"])(u(s,o))),!0;default:return!1}}}],[{key:"instance",get:function(){return this[$e]||(this[$e]=new e(ze)),this[$e]}}])}(),kt=Object.freeze({aligned:"Aligned",blended:"Blended",stitched:"Stitched",stitchedWithKeyPoints:"Stitched key points",sideBySideGood:"Side by side good matches",sideBySideGoodInliers:"Side by side inlier matches",selectionImage1:"Align selection image 1",selectionImage2:"Align selection image 2",keyPointsGoodFixed:"Matched key points image 1",keyPointsGoodMoving:"Matched Key points image 2",keyPointsInlierFixed:"Inlier key points image 1",keyPointsInlierMoving:"Inlier key points image 2"}),St=(kt.aligned,r("2397"),r("308d")),Dt=r("6bb5"),At=r("4e2b"),Ot=r("7618"),Tt=(r("28a5"),function(){function e(){Object(z["a"])(this,e),this.params=[{id:oe.detType.id,type:le.discrete,defaultValue:oe.detType_sift.id,value:oe.detType_sift.id,values:this.getDiscreteParams(oe.detType.id)},{id:oe.desType.id,type:le.discrete,defaultValue:oe.desType_sift.id,value:oe.desType_sift.id,values:this.getDiscreteParams(oe.desType.id)},{id:oe.matcherType.id,type:le.discrete,defaultValue:oe.matcherType_auto.id,value:oe.matcherType_auto.id,values:this.getDiscreteParams(oe.matcherType.id)},{id:oe.transformFinderType.id,type:le.discrete,defaultValue:oe.transformFinderType_ransac.id,value:oe.transformFinderType_ransac.id,values:this.getDiscreteParams(oe.transformFinderType.id)},{id:oe.compareDetTypes.id,type:le.multiple,defaultValue:[oe.detType_sift.id,oe.detType_orb.id,oe.detType_akaze.id].toString(),value:[oe.detType_sift.id,oe.detType_orb.id,oe.detType_akaze.id].toString(),values:this.getDiscreteParams(oe.detType.id)},{id:oe.compareImageType.id,type:le.discrete,defaultValue:oe.imageFirst.id,value:oe.imageFirst.id,values:this.getDiscreteParams(oe.compareImageType.id)},{id:oe.imageCap.id,type:le.rangeSquareRoot,defaultValue:3e5,value:3e5,range:{min:1e4,max:9e6}},{id:oe.imageCapInput.id,type:le.rangeSquareRoot,defaultValue:35e4,value:35e4,range:{min:1e4,max:16e6}},{id:oe.floodFillTolerance.id,type:le.range,defaultValue:20,value:20,range:{min:0,max:255}},{id:oe.alignSelectionOverlay.id,type:le.bool,defaultValue:1,value:1},{id:oe.logInfoEnabled.id,type:le.bool,defaultValue:0,value:0},{id:oe.logErrorEnabled.id,type:le.bool,defaultValue:1,value:1},{id:oe.logAssertEnabled.id,type:le.bool,defaultValue:1,value:1},{id:oe.logExternEnabled.id,type:le.bool,defaultValue:0,value:0},{id:oe.sift_featuresN.id,type:le.number,value:0,defaultValue:0},{id:oe.sift_octaveLayersN.id,type:le.number,value:3,defaultValue:3},{id:oe.sift_contrastThresh.id,type:le.number,value:.04,defaultValue:.04},{id:oe.sift_edgeThresh.id,type:le.number,value:10,defaultValue:10},{id:oe.sift_sigma.id,type:le.number,value:1.6,defaultValue:1.6},{id:oe.surf_hessianThresh.id,type:le.number,value:100,defaultValue:100},{id:oe.surf_octavesN.id,type:le.number,value:4,defaultValue:4},{id:oe.surf_octaveLayersN.id,type:le.number,value:3,defaultValue:3},{id:oe.surf_extended.id,type:le.bool,value:0,defaultValue:0},{id:oe.orb_featuresN.id,type:le.number,value:500,defaultValue:500},{id:oe.orb_scale.id,type:le.number,value:1.2,defaultValue:1.2},{id:oe.orb_levelsN.id,type:le.number,value:8,defaultValue:8},{id:oe.orb_edgeThresh.id,type:le.number,value:31,defaultValue:31},{id:oe.orb_patchSize.id,type:le.number,value:31,defaultValue:31},{id:oe.brisk_thresh.id,type:le.number,value:30,defaultValue:30},{id:oe.brisk_octavesN.id,type:le.number,value:3,defaultValue:3},{id:oe.brisk_patternScale.id,type:le.number,value:1,defaultValue:1},{id:oe.kaze_thresh.id,type:le.number,value:.001,defaultValue:.001},{id:oe.kaze_octavesN.id,type:le.number,value:4,defaultValue:4},{id:oe.kaze_octaveLayersN.id,type:le.number,value:4,defaultValue:4},{id:oe.akaze_thresh.id,type:le.number,value:.001,defaultValue:.001},{id:oe.akaze_octavesN.id,type:le.number,value:4,defaultValue:4},{id:oe.akaze_octaveLayersN.id,type:le.number,value:4,defaultValue:4},{id:oe.matchFilterSpreadAuto.id,type:le.bool,value:1,defaultValue:1},{id:oe.matchFilterSpreadFactor.id,type:le.number,value:2.2,defaultValue:2.2},{id:oe.matchFilterMinMatchesToRetain.id,type:le.number,value:300,defaultValue:300},{id:oe.matchFilterMaxMatchesToRetain.id,type:le.number,value:800,defaultValue:800},{id:oe.stitch_projection.id,type:le.discrete,defaultValue:oe.stitch_projectionTypeSpherical.id,value:oe.stitch_projectionTypeSpherical.id,values:this.getDiscreteParams(oe.stitch_projection.id)},{id:oe.stitch_projection2.id,type:le.discrete,defaultValue:oe.stitch_projectionTypeSpherical.id,value:oe.stitch_projectionTypeSpherical.id,values:this.getDiscreteParams(oe.stitch_projection2.id)},{id:oe.stitch_seamBlend.id,type:le.bool,value:1,defaultValue:1},{id:oe.stitch_colorTransfer.id,type:le.bool,value:0,defaultValue:0},{id:oe.stitch_fieldOfView1.id,type:le.numberAuto,value:45,defaultValue:45},{id:oe.stitch_yaw1.id,type:le.numberAuto,value:0,defaultValue:0},{id:oe.stitch_pitch1.id,type:le.numberAuto,value:0,defaultValue:0},{id:oe.stitch_fieldOfView2.id,type:le.numberAuto,value:45,defaultValue:45},{id:oe.stitch_yaw2.id,type:le.numberAuto,value:0,defaultValue:0,flagId:oe.stitch_yaw2Auto.id},{id:oe.stitch_pitch2.id,type:le.numberAuto,value:0,defaultValue:0,flagId:oe.stitch_pitch2Auto.id},{id:oe.stitch_yaw2Auto.id,type:le.bool,value:1,defaultValue:1},{id:oe.stitch_pitch2Auto.id,type:le.bool,value:1,defaultValue:1},{id:oe.multiStitch_projectionType.id,type:le.discrete,value:oe.stitch_projectionTypeSpherical.id,defaultValue:oe.stitch_projectionTypeSpherical.id,values:this.getDiscreteParams(oe.multiStitch_projectionType.id)},{id:oe.multiStitch_rectifyPerspective.id,type:le.bool,value:0,defaultValue:0},{id:oe.multiStitch_rectifyStretch.id,type:le.bool,value:0,defaultValue:0},{id:oe.multiStitch_maxRectangle.id,type:le.bool,value:0,defaultValue:0},{id:oe.multiStitch_camEstimate.id,type:le.bool,value:1,defaultValue:1},{id:oe.multiStitch_bundleAdjust.id,type:le.discrete,value:oe.bat_rayBlacklist.id,defaultValue:oe.bat_rayBlacklist.id,values:this.getDiscreteParams(oe.multiStitch_bundleAdjust.id)},{id:oe.multiStitch_waveCorrection.id,type:le.discrete,value:oe.waveCorrectionType_H.id,defaultValue:oe.waveCorrectionType_H.id,values:this.getDiscreteParams(oe.multiStitch_waveCorrection.id)},{id:oe.multiStitch_seamBlend.id,type:le.bool,value:1,defaultValue:1},{id:oe.multiStitch_seamFinderType.id,type:le.discrete,value:oe.seamFinderType_Vornoi.id,defaultValue:oe.seamFinderType_Vornoi.id,values:this.getDiscreteParams(oe.multiStitch_seamFinderType.id)},{id:oe.multiStitch_blendStrength.id,type:le.range,defaultValue:5,value:5,range:{min:0,max:100}},{id:oe.multiStitch_colorTransfer.id,type:le.bool,value:0,defaultValue:0},{id:oe.multiStitch_exposureCompensator.id,type:le.bool,value:0,defaultValue:0},{id:oe.multiStitch_calcCenterImage.id,type:le.bool,value:1,defaultValue:1},{id:oe.multiStitch_warpFirst.id,type:le.bool,value:0,defaultValue:0},{id:oe.multiStitch_confidenceThresh.id,type:le.range,defaultValue:.4,value:.4,range:{min:0,max:3},step:.01},{id:oe.multiStitch_inputImagesMatchReach.id,type:le.range,defaultValue:0,value:0,range:{min:1,max:40,maxReplace:0},step:1},{id:oe.multiStitch_limitResultPreview.id,type:le.rangeSquareRoot,defaultValue:8e5,value:8e5,range:{min:1e4,max:4e6}},{id:oe.multiStitch_limitInputView.id,type:le.rangeSquareRoot,defaultValue:1e5,value:1e5,range:{min:1e4,max:1e6}},{id:oe.multiStitch_disposeInputImages.id,type:le.bool,value:0,defaultValue:0},{id:oe.multiStitch_limitLiveStitchingPreview.id,type:le.rangeSquareRoot,defaultValue:2e5,value:2e5,range:{min:1e4,max:1e6}},{id:oe.multiStitch_preserveAlphaChannelValue.id,type:le.bool,value:0,defaultValue:0},{id:oe.multiStitch_liveUpdateCycle.id,type:le.range,defaultValue:5,value:5,range:{min:1,max:20}},{id:oe.openCvType.id,type:le.discrete,value:oe.openCvType_small.id,defaultValue:oe.openCvType_small.id,values:this.getDiscreteParams(oe.openCvType.id)}]}return Object(G["a"])(e,[{key:"getDiscreteParams",value:function(e){return Object.keys(oe).filter((function(t){return oe[t].groupId==e||oe[t].groupId2&&oe[t].groupId2==e||oe[t].groupId3&&oe[t].groupId3==e})).map((function(e){return oe[e]}))}},{key:"getParamDefaultValueById",value:function(e){return this._getParamById(e).defaultValue}},{key:"getParamValueById",value:function(e){return this._getParamById(e).value}},{key:"getParamValuesById",value:function(e){var t=this._getParamById(e);return this._throwIfNotMultiple(t),this._valueToArray(t.value)}},{key:"getParamDefaultValuesById",value:function(e){var t=this._getParamById(e);return this._throwIfNotMultiple(t),this._valueToArray(t.defaultValue)}},{key:"getParamValueNamesById",value:function(e){var t=this.getParamValuesById(e);return t.map((function(e){return ce.getParamName(e)}))}},{key:"setParamValueById",value:function(e,t){var r=this._getParamById(e);r.value=t}},{key:"getIdArr",value:function(){return this.params.map((function(e){return e.id}))}},{key:"getIdValueArr",value:function(){return this.params.map((function(e){return{id:e.id,value:e.value}}))}},{key:"getIdValueArrExcludingDefaults",value:function(){return this.params.filter((function(e){return e.value!=e.defaultValue})).map((function(e){return{id:e.id,value:e.value}}))}},{key:"getIdValueDefaultArr",value:function(){return this.params.map((function(e){return{id:e.id,value:e.value,defaultValue:e.defaultValue}}))}},{key:"setByIdValueArr",value:function(e){var t=this;e.forEach((function(e){t.setParamValueById(e.id,e.value)}))}},{key:"removeInvalidParams",value:function(e){var t=this;return e=e.filter((function(e){var r=t.params.find((function(t){return t.id==e.id}));if(!r)return!1;if(r.type==le.discrete){var a=t.getDiscreteParams(r.id);if(!a||!a.find((function(t){return t.id==e.value})))return!1}else if((r.type==le.range||r.type==le.rangeSquareRoot)&&(e.value<r.range.min||e.value>r.range.max))return!1;return!0})),e}},{key:"equals",value:function(e){if(null==e)return!this.params||0==this.params.length;if(e.length!=this.params.length)return!1;for(var t=0;t<e.length;++t){if(e[t].id!=this.params[t].id)return!1;if(e[t].value!=this.params[t].value)return!1}return!0}},{key:"getRelatingIdValue",value:function(e,t){switch(e){case oe.detType.id:switch(t){case oe.detType_sift.id:return{id:oe.desType.id,value:oe.desType_sift.id};case oe.detType_surf.id:return{id:oe.desType.id,value:oe.desType_surf.id};case oe.detType_orb.id:return{id:oe.desType.id,value:oe.desType_orb.id};case oe.detType_brisk.id:return{id:oe.desType.id,value:oe.desType_brisk.id};case oe.detType_kaze.id:return{id:oe.desType.id,value:oe.desType_kaze.id};case oe.detType_akaze.id:return{id:oe.desType.id,value:oe.desType_akaze.id};default:return null}default:return null}}},{key:"getCurrentDetTypeGroupKey",value:function(){var e=this.params.find((function(e){return e.id==oe.detType.id})),t=Object.keys(oe).find((function(t){return oe[t].id==e.value})),r=oe[t].name;return Object.keys(W).find((function(e){return W[e].name==r}))}},{key:"paramsByGroupKey",value:function(e){var t=this;return Object.keys(oe).filter((function(t){return oe[t].groupId==W[e].id||oe[t].groupId&&oe[t].groupId==W[e].id})).map((function(e){return t.params.find((function(t){return t.id==oe[e].id}))}))}},{key:"copyValuesTo",value:function(e){console.assert(this.params.length==e.params.length);for(var t=0;t<this.params.length;++t)console.assert(this.params[t].id===e.params[t].id),e.params[t].value!=this.params[t].value&&(e.params[t].value=this.params[t].value)}},{key:"getParamById",value:function(e){return this._getParamById(e)}},{key:"_getParamById",value:function(e){var t=this.params.find((function(t){return t.id==e}));if(!t)throw new Error("No param with id ${id} exists");return t}},{key:"_throwIfNotMultiple",value:function(e){if(e.type!=le.multiple)throw new Error("Param id/name ".concat(e.id,"/").concat(e.name," is not capable"))}},{key:"_valueToArray",value:function(e){return e?isNaN(Number(e))?e.split(",").map((function(e){return+e})):[+e]:[]}}])}()),Rt=function(){function e(t,r){if(Object(z["a"])(this,e),this._imageData=null,this._imageDataUrl=null,this._success=null,this._time=0,this._name=t,this._settings=new Tt,null==r||"function"==!Object(Ot["a"])(r))throw new Error("Need a valid conversion function");this._imageDataToUrlFn=r}return Object(G["a"])(e,[{key:"name",get:function(){return this.name}},{key:"imageData",get:function(){return this._imageData},set:function(e){this._imageData=e,this._imageDataUrl=e?this._imageDataToUrlFn(e):null}},{key:"imageDataUrl",get:function(){return this._imageDataUrl}},{key:"imageDataValid",get:function(){return this._imageData&&this._imageData.width>0&&this._imageData.height>0}},{key:"success",get:function(){return this._success},set:function(e){this._success=e}},{key:"time",get:function(){return this._time},set:function(e){this._time=e}},{key:"settings",get:function(){return this._settings},set:function(e){this._settings=e}},{key:"setImageData",value:function(e,t){this._imageData=e,this._imageDataUrl=e?t?this._imageDataToUrlFn(t):this._imageDataToUrlFn(e):null}}])}();function jt(e,t,r){return t=Object(Dt["a"])(t),Object(St["a"])(e,Ct()?Reflect.construct(t,r||[],Object(Dt["a"])(e).constructor):t.apply(e,r))}function Ct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Ct=function(){return!!e})()}var Ft=function(e){function t(e,r){var a;return Object(z["a"])(this,t),a=jt(this,t,[e,r]),a._matcherImageType=kt.aligned,a._matcherImageBlend=.5,a}return Object(At["a"])(t,e),Object(G["a"])(t,[{key:"matcherImageType",get:function(){return this._matcherImageType},set:function(e){this._matcherImageType=e}},{key:"matcherImageBlend",get:function(){return this._matcherImageBlend},set:function(e){this._matcherImageBlend=e}},{key:"setDefault",value:function(){this._matcherImageType=kt.aligned}}])}(Rt);function Pt(e,t,r){return t=Object(Dt["a"])(t),Object(St["a"])(e,Vt()?Reflect.construct(t,r||[],Object(Dt["a"])(e).constructor):t.apply(e,r))}function Vt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Vt=function(){return!!e})()}var Mt=function(e){function t(e,r){var a;return Object(z["a"])(this,t),a=Pt(this,t,[e,r]),a._compareTimeUsedPerDet=[],a._compareKeyPointsCountPerDet=[],a}return Object(At["a"])(t,e),Object(G["a"])(t,[{key:"compareTimeUsedPerDet",get:function(){return this._compareTimeUsedPerDet},set:function(e){this._compareTimeUsedPerDet=e}},{key:"compareKeyPointsCountPerDet",get:function(){return this._compareKeyPointsCountPerDet},set:function(e){this._compareKeyPointsCountPerDet=e}}])}(Rt);function Nt(e,t,r){return t=Object(Dt["a"])(t),Object(St["a"])(e,Et()?Reflect.construct(t,r||[],Object(Dt["a"])(e).constructor):t.apply(e,r))}function Et(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Et=function(){return!!e})()}var Bt=function(e){function t(e,r){var a;return Object(z["a"])(this,t),a=Nt(this,t,[e,r]),a._projected=!1,a._fieldOfView=null,a}return Object(At["a"])(t,e),Object(G["a"])(t,[{key:"projected",get:function(){return this._projected},set:function(e){this._projected=e}},{key:"fieldOfView",get:function(){return this._fieldOfView},set:function(e){this._fieldOfView=e}}])}(Rt);function Lt(e,t,r){return t=Object(Dt["a"])(t),Object(St["a"])(e,Ut()?Reflect.construct(t,r||[],Object(Dt["a"])(e).constructor):t.apply(e,r))}function Ut(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Ut=function(){return!!e})()}var qt=function(e){function t(e,r){var a;return Object(z["a"])(this,t),a=Lt(this,t,[e,r]),a._fieldOfView=null,a}return Object(At["a"])(t,e),Object(G["a"])(t,[{key:"fieldOfView",get:function(){return this._fieldOfView},set:function(e){this._fieldOfView=e}}])}(Rt),$t={imageResults:Object(ye["a"])(Object(ye["a"])(Object(ye["a"])(Object(ye["a"])({},L,new Ft(L,ve.imageSrcFromImageData)),U,new Mt(U,ve.imageSrcFromImageData)),q,new Bt(q,ve.imageSrcFromImageData)),$,new qt(q,ve.imageSrcFromImageData))},zt={imageData:function(e){return function(t){return e.imageResults[t].imageData}},imageDataUrl:function(e){return function(t){return e.imageResults[t].imageDataUrl}},imageDataValid:function(e){return function(t){return e.imageResults[t].imageDataValid}},success:function(e){return function(t){return e.imageResults[t].success}},time:function(e){return function(t){return e.imageResults[t].time}},settings:function(e){return function(t){return e.imageResults[t].settings}},matcherImageType:function(e){return e.imageResults[L].matcherImageType},matcherImageBlend:function(e){return e.imageResults[L].matcherImageBlend},compareTimeUsedPerDet:function(e){return e.imageResults[U].compareTimeUsedPerDet},compareKeyPointsCountPerDet:function(e){return e.imageResults[U].compareKeyPointsCountPerDet},stitcherProjected:function(e){return e.imageResults[q].projected},stitcherFieldOfView:function(e){return e.imageResults[q].fieldOfView},multiStitcherFieldOfView:function(e){return e.imageResults[$].fieldOfView}},Gt={imageData:function(e,t){var r=t.name,a=t.imageData,i=t.imageDataSmall;a?e.imageResults[r].setImageData(a,i):e.imageResults[r].imageData=null},success:function(e,t){var r=t.name,a=t.success;e.imageResults[r].success=a},time:function(e,t){var r=t.name,a=t.time;e.imageResults[r].time=a},settings:function(e,t){var r=t.name,a=t.settings;a&&a.copyValuesTo(e.imageResults[r].settings)},matcherImageType:function(e,t){e.imageResults[L].matcherImageType=t},matcherImageTypeSetDefault:function(e){e.imageResults[L].setDefault()},matcherImageBlend:function(e,t){e.imageResults[L].matcherImageBlend=t},compareTimeUsedPerDet:function(e,t){e.imageResults[U].compareTimeUsedPerDet=t},compareKeyPointsCountPerDet:function(e,t){e.imageResults[U].compareKeyPointsCountPerDet=t},stitcherProjected:function(e,t){return e.imageResults[q].projected=t},stitcherFieldOfView:function(e,t){return e.imageResults[q].fieldOfView=t},multiStitcherFieldOfView:function(e,t){return e.imageResults[$].fieldOfView=t}},Wt={},Kt={namespaced:!0,state:$t,getters:zt,mutations:Gt,actions:Wt},Ht={loadStartTime:null,loadTime:null,ready:!1,error:null,busyImage:!1,busyCompute:!1,busyLoad:!1,currentActionInfo:"",lastCompletedActionTime:0,currentActionStartTime:null,currentComputeTime:null,currentLoadingTime:null},Yt={ready:function(e){return e.ready},loadTime:function(e){return e.loadTime},error:function(e){return e.error},busy:function(e){return e.busyImage||e.busyCompute||e.busyLoad},busyImage:function(e){return e.busyImage},busyCompute:function(e){return e.busyCompute},busyLoad:function(e){return e.busyLoad},currentActionInfo:function(e){return e.currentActionInfo},currentActionTime:function(e){return e.currentActionInfo&&e.currentActionStartTime?new Date-e.currentActionStartTime:null},lastCompletedActionTime:function(e){return e.lastCompletedActionTime},currentComputeTime:function(e){return e.currentComputeTime},currentLoadingTime:function(e){return e.currentLoadingTime}},Jt={_init:function(e){e.ready||(e.loadStartTime=new Date)},_ready:function(e,t){t&&e.loadStartTime&&(e.loadTime=new Date-e.loadStartTime),e.ready=t,console.log("[store][worker][mutation][ready][time][ms]: ".concat(e.loadTime,", ").concat(t))},error:function(e,t){e.error=t},_busyCompute:function(e,t){e.busyCompute=t},_busyImage:function(e,t){e.busyImage=t},_busyLoad:function(e,t){e.busyLoad=t},currentActionInfo:function(e,t){e.currentActionInfo=t,t?e.currentActionStartTime=new Date:e.currentActionStartTime&&(e.lastCompletedActionTime=new Date-e.currentActionStartTime,e.currentActionStartTime=null)},currentComputeTime:function(e,t){e.currentComputeTime=t},currentLoadingTime:function(e,t){e.currentLoadingTime=t}},Xt={load:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t){var r,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.getters["ready"]){e.next=2;break}return e.abrupt("return");case 2:if(!t.getters["busy"]){e.next=4;break}return e.abrupt("return");case 4:return t.commit("_busyLoad",!0),t.commit("_init",t),t.commit("currentActionInfo","Loading opencv"),e.prev=7,r=t.rootGetters["settings/param"](oe.openCvType.id),a="opencv_3_4_custom_Oz.js",r==oe.openCvType_fast.id&&(a="opencv_3_4_custom_O3.js"),e.next=13,xt.instance.loadAsync(a);case 13:t.commit("_ready",!0),e.next=20;break;case 16:e.prev=16,e.t0=e["catch"](7),console.log("[store][worker][load][Error]",e.t0),t.commit("error",e.t0);case 20:return e.prev=20,t.commit("currentActionInfo",""),t.commit("_busyLoad",!1),e.finish(20);case 24:case"end":return e.stop()}}),e,null,[[7,16,20,24]])})));function t(t){return e.apply(this,arguments)}return t}(),reload:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return xt.instance.reInitWorker(),t.commit("error",null),t.commit("_busyCompute",!1),t.commit("_ready",!1),e.next=6,t.dispatch("load");case 6:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}(),error:function(e,t){e.commit("error",t)},resetWorkerData:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.getters["busy"]){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,xt.instance.resetWorkerDataAsync();case 4:t.commit("results/success",{name:L,success:0}),t.commit("error",null);case 6:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}(),multiStitchResetWorkerData:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.getters["busy"]){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,xt.instance.resetMultiStitchWorkerDataAsync();case 4:t.commit("results/success",{name:$,success:0}),t.commit("error",null);case 6:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}(),_requestImage:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t,r){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.getters["busy"]){e.next=2;break}throw new Error("Cannot request image while busy");case 2:if(t.getters["results/success"](L)){e.next=4;break}return e.abrupt("return");case 4:return e.prev=4,t.commit("_busyImage",!0),t.commit("error",null),e.next=9,r();case 9:a=e.sent,t.commit("results/imageData",{name:L,imageData:a}),e.next=19;break;case 13:e.prev=13,e.t0=e["catch"](4),console.log("[store][worker][generic][Error]",e.t0),t.commit("error",e.t0),t.commit("results/imageData",{name:L,imageData:null}),t.commit("results/success",{name:L,success:0});case 19:return e.prev=19,t.commit("currentActionInfo",""),t.commit("_busyImage",!1),e.finish(19);case 23:case"end":return e.stop()}}),e,null,[[4,13,19,23]])})));function t(t,r){return e.apply(this,arguments)}return t}(),computeMultiStitchedImage:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t,r){var a,i,n,s,o,u,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=r.images,i=r.fieldsOfView,n=r.settings,!t.getters["busy"]){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,t.commit("_busyCompute",!0),t.commit("error",null),t.commit("currentActionInfo","Stitching"),s=new Date,e.next=10,xt.instance.multiStitch(a,i,n.getIdValueArrExcludingDefaults());case 10:o=e.sent,u=o.imageData,c=o.stitchedImagesN,t.commit("results/imageData",{name:$,imageData:u}),t.commit("results/time",{name:$,time:new Date-s}),t.commit("results/success",{name:$,success:c==a.length?1:0}),e.next=24;break;case 18:e.prev=18,e.t0=e["catch"](3),console.log("[store][worker][computeStitchedImage][Error]",e.t0),t.commit("error",e.t0),t.commit("results/imageData",{name:$,imageData:null}),t.commit("results/success",{name:$,success:0});case 24:return e.prev=24,t.commit("currentActionInfo",""),t.commit("_busyCompute",!1),e.finish(24);case 28:case"end":return e.stop()}}),e,null,[[3,18,24,28]])})));function t(t,r){return e.apply(this,arguments)}return t}(),computeMultiStitchImageInSteps:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t,r){var a,i,n,s,o,u,c,l,m,d,g,p,h,f,y,v;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=r.images,i=r.fieldsOfView,n=r.settings,!t.getters["busy"]){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,t.commit("_busyCompute",!0),t.commit("error",null),t.commit("currentActionInfo","Detecting Features"),s=new Date,e.next=10,xt.instance.multiStitchStart(a,i,n.getIdValueArrExcludingDefaults());case 10:o=e.sent,u=o.imageData,c=o.stitchIndices,l=t.rootGetters["settings/param"](oe.multiStitch_disposeInputImages.id),l&&t.commit("multiInput/freeImageData",null,{root:!0}),m=[],d=regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:c.some((function(e){return e==t}))||m.push(t);case 1:case"end":return e.stop()}}),e)})),g=0;case 18:if(!(g<a.length)){e.next=23;break}return e.delegateYield(d(g),"t0",20);case 20:++g,e.next=18;break;case 23:m.length>0&&(console.warn("[store][worker][computeMultiStitchImageInSteps]","No match found for image/s with index ".concat(m.map((function(e){return" "+e})))),t.commit("logs/addErrorMessage","No match found for image/s with index ".concat(m.map((function(e){return" "+e}))),{root:!0})),t.commit("results/imageData",{name:$,imageData:u}),p=c.length-1;case 26:if(!(p>0)){e.next=36;break}return e.next=29,xt.instance.multiStitchNext();case 29:h=e.sent,f=h.imageData,y=h.imageDataSmall,v=h.stitchedImagesN,0==v?(p=0,console.warn("[store][worker][computeMultiStitchImageInSteps]","Unexpected result from multiStitchNext")):(p=c.length-v,t.commit("results/imageData",{name:$,imageData:f,imageDataSmall:y})),e.next=26;break;case 36:t.commit("results/time",{name:$,time:new Date-s}),t.commit("results/success",{name:$,success:1}),e.next=45;break;case 40:e.prev=40,e.t1=e["catch"](3),console.log("[store][worker][computeMultiStitchImageInSteps][Error]",e.t1),t.commit("error",e.t1),t.commit("results/success",{name:$,success:0});case 45:return e.prev=45,t.commit("currentActionInfo",""),t.commit("_busyCompute",!1),e.finish(45);case 49:case"end":return e.stop()}}),e,null,[[3,40,45,49]])})));function t(t,r){return e.apply(this,arguments)}return t}(),computeAlignedImage:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t,r){var a,i,n,s,o,u,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=r.fixedImage,i=r.movingImage,n=r.fixedImagePolygonPts,s=r.movingImagePolygonPts,o=r.settings,!t.getters["busy"]){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,t.commit("_busyCompute",!0),t.commit("error",null),t.commit("currentActionInfo","Feature detection"),u=new Date,e.next=10,xt.instance.matchAsync(a,i,o.getIdValueArrExcludingDefaults(),n,s);case 10:c=e.sent,t.commit("results/time",{name:L,time:new Date-u}),t.commit("results/success",{name:L,success:c}),e.next=21;break;case 15:e.prev=15,e.t0=e["catch"](3),console.log("[store][worker][computeAlignedImage][Error]",e.t0),t.commit("error",e.t0),t.commit("results/imageData",{name:L,imageData:null}),t.commit("results/success",{name:L,success:0});case 21:return e.prev=21,t.commit("currentActionInfo",""),t.commit("_busyCompute",!1),e.finish(21);case 25:return e.next=27,t.dispatch("requestImage");case 27:case"end":return e.stop()}}),e,null,[[3,15,21,25]])})));function t(t,r){return e.apply(this,arguments)}return t}(),requestImage:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:r=t.getters["results/matcherImageType"],e.t0=r,e.next=e.t0===kt.aligned?4:e.t0===kt.blended?7:e.t0===kt.stitched?10:e.t0===kt.stitchedWithKeyPoints?13:e.t0===kt.selectionImage1?16:e.t0===kt.selectionImage2?24:e.t0===kt.keyPointsGoodFixed?32:e.t0===kt.keyPointsGoodMoving?35:e.t0===kt.keyPointsInlierFixed?38:e.t0===kt.keyPointsInlierMoving?41:e.t0===kt.sideBySideGood?44:e.t0===kt.sideBySideGoodInliers?47:50;break;case 4:return e.next=6,t.dispatch("requestAlignedImage");case 6:return e.abrupt("break",51);case 7:return e.next=9,t.dispatch("requestBlendedImage",{weight:t.getters["results/matcherImageBlend"],doOverlay:t.rootGetters["settings/param"](oe.alignSelectionOverlay.id)});case 9:return e.abrupt("break",51);case 10:return e.next=12,t.dispatch("requestStitchedImage",{weight:t.getters["results/matcherImageBlend"]});case 12:return e.abrupt("break",51);case 13:return e.next=15,t.dispatch("requestStitchedImageWithKeyPoints",{weight:t.getters["results/matcherImageBlend"]});case 15:return e.abrupt("break",51);case 16:if(0===t.rootGetters["input/polygonClosedPts"](E).length){e.next=21;break}return e.next=19,t.dispatch("requestBlendedImagePolygon",{weight:t.getters["results/matcherImageBlend"],doOverlay:t.rootGetters["settings/param"](oe.alignSelectionOverlay.id),polygon:t.rootGetters["input/polygonClosedPts"](E),isFixedImage:!0});case 19:e.next=23;break;case 21:return e.next=23,t.dispatch("requestBlendedImageFloodFill",{weight:t.getters["results/matcherImageBlend"],doOverlay:t.rootGetters["settings/param"](oe.alignSelectionOverlay.id),pts:t.rootGetters["input/pathPts"](E),floodFillTolerances:t.rootGetters["input/floodFillTolerances"](E),isFixedImage:!0});case 23:return e.abrupt("break",51);case 24:if(0===t.rootGetters["input/polygonClosedPts"](B).length){e.next=29;break}return e.next=27,t.dispatch("requestBlendedImagePolygon",{weight:t.getters["results/matcherImageBlend"],doOverlay:t.rootGetters["settings/param"](oe.alignSelectionOverlay.id),polygon:t.rootGetters["input/polygonClosedPts"](B),isFixedImage:!1});case 27:e.next=31;break;case 29:return e.next=31,t.dispatch("requestBlendedImageFloodFill",{weight:t.getters["results/matcherImageBlend"],doOverlay:t.rootGetters["settings/param"](oe.alignSelectionOverlay.id),pts:t.rootGetters["input/pathPts"](B),floodFillTolerances:t.rootGetters["input/floodFillTolerances"](B),isFixedImage:!1});case 31:return e.abrupt("break",51);case 32:return e.next=34,t.dispatch("requestKeyPointsGoodFixedImage");case 34:return e.abrupt("break",51);case 35:return e.next=37,t.dispatch("requestKeyPointsGoodMovingImage");case 37:return e.abrupt("break",51);case 38:return e.next=40,t.dispatch("requestKeyPointsInlierFixedImage");case 40:return e.abrupt("break",51);case 41:return e.next=43,t.dispatch("requestKeyPointsInlierMovingImage");case 43:return e.abrupt("break",51);case 44:return e.next=46,t.dispatch("requestSideBySideImageGood");case 46:return e.abrupt("break",51);case 47:return e.next=49,t.dispatch("requestSideBySideImageGoodInliers");case 49:return e.abrupt("break",51);case 50:return e.abrupt("break",51);case 51:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}(),requestAlignedImage:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.commit("currentActionInfo","Requesting aligned image"),t.dispatch("_requestImage",Object(v["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,xt.instance.requestAlignedImageAsync();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))));case 2:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}(),requestBlendedImage:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t,r){var a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:a=r.weight,i=r.doOverlay,t.commit("currentActionInfo","Requesting blended image"),t.dispatch("_requestImage",Object(v["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,xt.instance.requestBlendedImageAsync(a,i);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))));case 3:case"end":return e.stop()}}),e)})));function t(t,r){return e.apply(this,arguments)}return t}(),requestStitchedImage:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t,r){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:a=r.weight,t.commit("currentActionInfo","Requesting stitched image"),t.dispatch("_requestImage",Object(v["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,xt.instance.requestStitchedImageAsync(a);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))));case 3:case"end":return e.stop()}}),e)})));function t(t,r){return e.apply(this,arguments)}return t}(),requestStitchedImageWithKeyPoints:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t,r){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:a=r.weight,t.commit("currentActionInfo","Requesting stitched image"),t.dispatch("_requestImage",Object(v["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,xt.instance.requestStitchedImageWithKeyPointsAsync(a);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))));case 3:case"end":return e.stop()}}),e)})));function t(t,r){return e.apply(this,arguments)}return t}(),requestBlendedImagePolygon:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t,r){var a,i,n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:a=r.weight,i=r.doOverlay,n=r.polygon,s=r.isFixedImage,t.commit("currentActionInfo","Requesting blended image"),t.dispatch("_requestImage",Object(v["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,xt.instance.requestBlendedImagePolygonAsync(a,i,n,s);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))));case 3:case"end":return e.stop()}}),e)})));function t(t,r){return e.apply(this,arguments)}return t}(),requestBlendedImageFloodFill:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t,r){var a,i,n,s,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:a=r.weight,i=r.doOverlay,n=r.pts,s=r.floodFillTolerances,o=r.isFixedImage,t.commit("currentActionInfo","Requesting blended image"),t.dispatch("_requestImage",Object(v["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,xt.instance.requestBlendedImageFloodFillAsync(a,i,n,s,o);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))));case 3:case"end":return e.stop()}}),e)})));function t(t,r){return e.apply(this,arguments)}return t}(),requestSideBySideImageGood:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.commit("currentActionInfo","Requesting side by side image"),t.dispatch("_requestImage",Object(v["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,xt.instance.requestSideBySideImageGoodAsync();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))));case 2:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}(),requestSideBySideImageGoodInliers:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.commit("currentActionInfo","Requesting side by side image"),t.dispatch("_requestImage",Object(v["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,xt.instance.requestSideBySideImageGoodInliersAsync();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))));case 2:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}(),requestKeyPointsGoodFixedImage:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.commit("currentActionInfo","Requesting image with key points"),t.dispatch("_requestImage",Object(v["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,xt.instance.requestKeyPointsGoodFixedImageAsync();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))));case 2:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}(),requestKeyPointsGoodMovingImage:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.commit("currentActionInfo","Requesting image with key points"),t.dispatch("_requestImage",Object(v["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,xt.instance.requestKeyPointsGoodMovingImageAsync();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))));case 2:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}(),requestKeyPointsInlierFixedImage:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.commit("currentActionInfo","Requesting image with key points"),t.dispatch("_requestImage",Object(v["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,xt.instance.requestKeyPointsInlierFixedImageAsync();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))));case 2:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}(),requestKeyPointsInlierMovingImage:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.commit("currentActionInfo","Requesting image with key points"),t.dispatch("_requestImage",Object(v["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,xt.instance.requestKeyPointsInlierMovingImageAsync();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))));case 2:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}(),computeCompareImage:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t,r){var a,i,n,s,o,u,c,l,m,d,g,p,h;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=r.fixedImage,i=r.movingImage,n=r.fixedImagePolygonPts,s=r.movingImagePolygonPts,o=r.settings,!t.getters["busy"]){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,t.commit("_busyCompute",!0),t.commit("error",null),t.commit("currentActionInfo","Feature detection"),u=o.getParamValuesById(oe.compareDetTypes.id),c=o.getParamValueById(oe.compareImageType.id),l=o.getIdValueArrExcludingDefaults(),m=new Date,e.next=13,xt.instance.compare_requestImageAsync(a,i,l,c,u,n,s);case 13:d=e.sent,g=d.imageData,p=d.timeUsedArr,h=d.keyPointsCountArr,t.commit("results/imageData",{name:U,imageData:g}),t.commit("results/compareTimeUsedPerDet",p),t.commit("results/compareKeyPointsCountPerDet",h),t.commit("results/time",{name:U,time:new Date-m}),t.commit("results/success",{name:U,success:1}),t.commit("results/settings",{name:U,settings:o}),e.next=31;break;case 25:e.prev=25,e.t0=e["catch"](3),console.log("[store][worker][generic][Error]",e.t0),t.commit("error",e.t0),t.commit("results/imageData",{name:U,imageData:null}),t.commit("results/success",{name:U,success:0});case 31:return e.prev=31,t.commit("currentActionInfo",""),t.commit("_busyCompute",!1),e.finish(31);case 35:case"end":return e.stop()}}),e,null,[[3,25,31,35]])})));function t(t,r){return e.apply(this,arguments)}return t}(),displayStitchedImage:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t){var r,a,i,n,s,o,u,c,l,m,d,g,p,h,f,y;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.getters["busy"]){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,t.commit("_busyImage",!0),t.commit("currentActionInfo","Stitching image"),r=t.rootGetters["settings/param"](oe.stitch_projection.id),a=t.rootGetters["settings/param"](oe.stitch_projection2.id),i=t.rootGetters["settings/param"](oe.stitch_seamBlend.id),n=t.rootGetters["settings/param"](oe.stitch_colorTransfer.id),s=t.rootGetters["settings/param"](oe.stitch_fieldOfView1.id),o=t.rootGetters["settings/param"](oe.stitch_fieldOfView2.id),u=t.rootGetters["settings/param"](oe.stitch_yaw1.id),c=t.rootGetters["settings/param"](oe.stitch_pitch1.id),l=t.rootGetters["settings/param"](oe.stitch_yaw2.id),m=t.rootGetters["settings/param"](oe.stitch_pitch2.id),d=t.rootGetters["settings/param"](oe.stitch_yaw2Auto.id),g=t.rootGetters["settings/param"](oe.stitch_pitch2Auto.id),e.next=19,xt.instance.stitchAsync(r,a,i,n,s,o,d,g,u,c,l,m);case 19:p=e.sent,h=p.fieldOfView,f=p.imageData,y=a!=oe.stitch_projectionTypeNone,t.commit("results/stitcherFieldOfView",Math.round(h)),t.commit("results/stitcherProjected",y),t.commit("results/imageData",{name:q,imageData:f}),e.next=33;break;case 28:e.prev=28,e.t0=e["catch"](2),console.log("[store][worker][displayStitchedImage][Error]",e.t0),t.commit("results/imageData",{name:q,imageData:null}),t.commit("error",e.t0);case 33:return e.prev=33,t.commit("currentActionInfo",""),t.commit("_busyImage",!1),e.finish(33);case 37:case"end":return e.stop()}}),e,null,[[2,28,33,37]])})));function t(t){return e.apply(this,arguments)}return t}(),computeStitchedImage:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t,r){var a,i,n,s,o,u,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=r.fixedImage,i=r.movingImage,n=r.fixedImagePolygonPts,s=r.movingImagePolygonPts,o=r.settings,!t.getters["busy"]){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,t.commit("_busyCompute",!0),t.commit("error",null),t.commit("currentActionInfo","Feature detection"),u=new Date,e.next=10,xt.instance.matchAsync(a,i,o.getIdValueArrExcludingDefaults(),n,s);case 10:c=e.sent,t.commit("results/time",{name:q,time:new Date-u}),t.commit("results/success",{name:q,success:c}),e.next=21;break;case 15:e.prev=15,e.t0=e["catch"](3),console.log("[store][worker][computeStitchedImage][Error]",e.t0),t.commit("error",e.t0),t.commit("results/imageData",{name:q,imageData:null}),t.commit("results/success",{name:q,success:0});case 21:return e.prev=21,t.commit("currentActionInfo",""),t.commit("_busyCompute",!1),e.finish(21);case 25:case"end":return e.stop()}}),e,null,[[3,15,21,25]])})));function t(t,r){return e.apply(this,arguments)}return t}(),setInputImageResized:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t,r){var a,i,n,s,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=r.imageName,i=r.imageDataSrc,n=r.width,s=r.height,!t.getters["busy"]){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,t.commit("_busyImage",!0),t.commit("currentActionInfo","Resizing image"),e.next=8,xt.instance.requestResizedImageAsync(i,n,s);case 8:o=e.sent,t.dispatch("input/imageData",{name:a,imageData:o},{root:!0}),e.next=16;break;case 12:e.prev=12,e.t0=e["catch"](3),console.log("[store][worker][setInputImageResized][Error]",e.t0),t.commit("error",e.t0);case 16:return e.prev=16,t.commit("currentActionInfo",""),t.commit("_busyImage",!1),e.finish(16);case 20:case"end":return e.stop()}}),e,null,[[3,12,16,20]])})));function t(t,r){return e.apply(this,arguments)}return t}(),setMultiInputImageResized:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t,r){var a,i,n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=r.imageDataSrc,i=r.width,n=r.height,!t.getters["busy"]){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,t.commit("_busyImage",!0),t.commit("currentActionInfo","Resizing image"),e.next=8,xt.instance.requestResizedImageAsync(a,i,n);case 8:return s=e.sent,t.commit("_busyImage",!1),e.next=12,t.dispatch("multiInput/imageData",s,{root:!0});case 12:e.next=18;break;case 14:e.prev=14,e.t0=e["catch"](3),console.log("[store][worker][setMultiInputImageResized][Error]",e.t0),t.commit("error",e.t0);case 18:return e.prev=18,t.commit("currentActionInfo",""),t.commit("_busyImage",!1),e.finish(18);case 22:case"end":return e.stop()}}),e,null,[[3,14,18,22]])})));function t(t,r){return e.apply(this,arguments)}return t}(),setMultiInputImageUrlResized:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t,r){var a,i,n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=r.imageDataSrc,i=r.width,n=r.height,!t.getters["busy"]){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,t.commit("_busyImage",!0),t.commit("currentActionInfo","Resizing image (base64)"),e.next=8,xt.instance.requestResizedImageAsync(a,i,n);case 8:return s=e.sent,t.commit("_busyImage",!1),e.next=12,t.dispatch("multiInput/imageDataUrl",s,{root:!0});case 12:e.next=18;break;case 14:e.prev=14,e.t0=e["catch"](3),console.log("[store][worker][setMultiInputImageUrlResized][Error]",e.t0),t.commit("error",e.t0);case 18:return e.prev=18,t.commit("currentActionInfo",""),t.commit("_busyImage",!1),e.finish(18);case 22:case"end":return e.stop()}}),e,null,[[3,14,18,22]])})));function t(t,r){return e.apply(this,arguments)}return t}(),saveResultImage:function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t,r){var a,i,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=r.name,i=r.imageFileName,!t.getters["busyImage"]){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,t.commit("_busyImage",!0),e.next=7,ve.imageBlobFromImageData(t.getters["results/imageData"](a));case 7:n=e.sent,Object(qe["saveAs"])(n,i);case 9:return e.prev=9,setTimeout((function(){t.commit("_busyImage",!1)}),500),e.finish(9);case 12:case"end":return e.stop()}}),e,null,[[3,,9,12]])})));function t(t,r){return e.apply(this,arguments)}return t}()},Qt={results:Kt},Zt={namespaced:!0,state:Ht,getters:Yt,mutations:Jt,actions:Xt,modules:Qt},er=function(){function e(){Object(z["a"])(this,e)}return Object(G["a"])(e,null,[{key:"saveIdValue",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null==r||t!=r)localStorage.setItem(e.toString(),t.toString());else{var a=e.toString();localStorage.getItem(a)&&localStorage.removeItem(a)}}},{key:"saveIdValueArr",value:function(e){var t=this;e.forEach((function(e){t.saveIdValue(e.id,e.value,e.defaultValue||(0===e.defaultValue?0:null))}))}},{key:"_getValueById",value:function(e){var t=localStorage.getItem(e.toString());if(""===t)return t;if(null===t)return null;var r=Number(t);return isNaN(Number(r))?t:r}},{key:"getIdValueArr",value:function(e){var t=this,r=[];return e.forEach((function(e){var a=t._getValueById(e);(a||0===a)&&r.push({id:e,value:a})})),r}}])}(),tr={settings:new Tt,defaultSettings:null,activeTabIndexDetector:null,activeTabIndexStitcher:null,stitcherSettingsOn:!1,activeTabIndexMultiStitcher:!1,multiStitcherSettingsOn:!1},rr={param:function(e){return function(t){return e.settings.getParamValueById(t)}},paramDefault:function(e){return function(t){return e.settings.getParamDefaultValueById(t)}},settings:function(e){return e.settings},equalsDefault:function(e){return e.settings.equals(e.defaultSettings)},idValueArrExcludingDefaults:function(e){return e.settings.getIdValueArrExcludingDefaults()},activeTabIndexDetector:function(e){return e.activeTabIndexDetector},getCurrentDetTypeGroupKey:function(e){return e.settings.getCurrentDetTypeGroupKey()},activeTabIndexStitcher:function(e){return e.activeTabIndexStitcher},stitcherSettingsOn:function(e){return e.stitcherSettingsOn},multiStitcherSettingsOn:function(e){return e.multiStitcherSettingsOn},activeTabIndexMultiStitcher:function(e){return e.activeTabIndexMultiStitcher}},ar={param:function(e,t){var r=t.id,a=t.value;e.settings.setParamValueById(r,a)},params:function(e,t){e.settings.setByIdValueArr(t)},default:function(e){e.settings=new Tt},defaultSettings:function(e,t){e.defaultSettings=Object.freeze(t)},activeTabIndexDetector:function(e,t){e.activeTabIndexDetector=t},activeTabIndexStitcher:function(e,t){e.activeTabIndexStitcher=t},stitcherSettingsOn:function(e,t){e.stitcherSettingsOn=t},multiStitcherSettingsOn:function(e,t){e.multiStitcherSettingsOn=t},activeTabIndexMultiStitcher:function(e,t){e.activeTabIndexMultiStitcher=t}},ir={init:function(e){var t=e.getters["settings"];e.commit("defaultSettings",t.getIdValueArr());var r=er.getIdValueArr(t.getIdArr());r=t.removeInvalidParams(r),e.commit("params",r)},param:function(e,t){var r=e.commit,a=e.getters,i=t.id,n=t.value,s=a["settings"];r("param",{id:i,value:n}),er.saveIdValue(i,n,s.getParamDefaultValueById(i));var o=s.getRelatingIdValue(i,n);o&&(r("param",{id:o.id,value:o.value}),er.saveIdValue(o.id,o.value,s.getParamDefaultValueById(o.id)))},default:function(e){var t=e.commit,r=e.getters;t("default");var a=r["settings"].getIdValueDefaultArr();er.saveIdValueArr(a)},activeTabIndexDetector:function(e,t){var r=e.commit;r("activeTabIndexDetector",t)},activeTabIndexStitcher:function(e,t){var r=e.commit;r("activeTabIndexStitcher",t)},stitcherSettingsOn:function(e,t){var r=e.commit;r("stitcherSettingsOn",t)},multiStitcherSettingsOn:function(e,t){var r=e.commit;r("multiStitcherSettingsOn",t)},activeTabIndexMultiStitcher:function(e,t){var r=e.commit;r("activeTabIndexMultiStitcher",t)}},nr={namespaced:!0,state:tr,getters:rr,mutations:ar,actions:ir},sr=null,or={maxMessagesCount:50,messages:[],totalCount:0,infoMessafe:"",maxErrorMessagesCount:15,errorMessages:[],currentErrorMessage:""},ur={messages:function(e){return e.messages},totalCount:function(e){return e.totalCount},errorMessages:function(e){return e.errorMessages},currentErrorMessage:function(e){return e.currentErrorMessage}},cr={addMessage:function(e,t){e.maxMessagesCount==e.messages.length&&e.messages.shift(),e.messages.push((new Date).toLocaleTimeString()+": "+t),e.totalCount++},setInfoMessage:function(e,t){e.infoMessafe=t},addErrorMessage:function(e,t){e.maxErrorMessagesCount==e.errorMessages.length&&e.errorMessages.shift(),e.errorMessages.push((new Date).toLocaleTimeString()+": "+t),sr&&(clearTimeout(sr),sr=null),e.currentErrorMessage=t,sr=setTimeout((function(){e.currentErrorMessage=""}),3e3)}},lr={},mr={namespaced:!0,state:or,getters:ur,mutations:cr,actions:lr};a["a"].use(fe["a"]);var dr=new fe["a"].Store({state:{},getters:{},mutations:{},actions:{},modules:{worker:Zt,settings:nr,input:Me,multiInput:Ue,logs:mr}}),gr=r("9483");Object(gr["a"])("".concat("/imgalign/","workbox-sw.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(e){console.error("Error during service worker registration:",e)}}),a["a"].config.productionTip=!1,a["a"].prototype.$cvready={},a["a"].prototype.$cvready.cbs=[],a["a"].prototype.$cvready.addCb=function(e){a["a"].prototype.$cvready.cbs.push(e)},new a["a"]({router:he,store:dr,render:function(e){return e(g)}}).$mount("#app")},"5c22":function(e,t,r){e.exports=r.p+"img/mountains1.24b57b69.jpg"},"5fba":function(e,t,r){e.exports=r.p+"img/mountains2.47f92173.jpg"},"74f9":function(e,t,r){},"801b":function(e,t,r){},8832:function(e,t,r){},acb3:function(e,t,r){"use strict";r("801b")},ba28:function(e,t,r){},d35d:function(e,t,r){"use strict";r("8832")},fdf1:function(e,t,r){"use strict";r("38cc")}});
//# sourceMappingURL=app.dc8d925a.js.map